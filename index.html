<!DOCTYPE html>
<html lang="uk" data-theme="dark" data-lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0f0a" id="meta-theme">
<title>TALKO AI Assistants</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--primary:#22c55e;--primary-dark:#16a34a;--primary-glow:rgba(34,197,94,0.15);--red:#ef4444;--safe-top:env(safe-area-inset-top,0px);--safe-bottom:env(safe-area-inset-bottom,0px);--safe-left:env(safe-area-inset-left,0px);--safe-right:env(safe-area-inset-right,0px);--topbar-h:57px}
[data-theme="dark"]{--bg-main:#0a0f0a;--bg-card:#111811;--bg-input:#1a231a;--bg-hover:#1e2b1e;--text-primary:#e8f5e8;--text-secondary:#8aab8a;--text-muted:#5a755a;--border:#1e2e1e;--border-light:#2a3d2a;--msg-user-bg:linear-gradient(135deg,var(--primary),var(--primary-dark));--msg-user-text:#fff;--msg-ai-bg:#1a231a;--msg-ai-text:#e8f5e8;--shadow-card:0 2px 12px rgba(0,0,0,0.3);--topbar-bg:rgba(17,24,17,0.92)}
[data-theme="light"]{--bg-main:#f0f5ee;--bg-card:#ffffff;--bg-input:#f5f8f5;--bg-hover:#e8f0e8;--text-primary:#1a2e1a;--text-secondary:#4a6a4a;--text-muted:#7a9a7a;--border:#d4e4d4;--border-light:#e0ece0;--msg-user-bg:linear-gradient(135deg,var(--primary),var(--primary-dark));--msg-user-text:#fff;--msg-ai-bg:#f0f5ee;--msg-ai-text:#1a2e1a;--shadow-card:0 2px 12px rgba(0,0,0,0.06);--topbar-bg:rgba(255,255,255,0.92)}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{height:100%;overflow:hidden}
body{font-family:'Space Grotesk',sans-serif;background:var(--bg-main);color:var(--text-primary);height:100%;overflow:hidden;transition:background .3s,color .3s;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-size-adjust:100%;-webkit-text-size-adjust:100%}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse-green{0%,100%{box-shadow:0 0 0 0 rgba(34,197,94,0.3)}50%{box-shadow:0 0 20px 4px rgba(34,197,94,0.15)}}
@keyframes typing-dot{0%,60%,100%{opacity:0.3;transform:scale(0.8)}30%{opacity:1;transform:scale(1)}}

/* === SCREENS === */
.screen{display:none;height:100%}.screen.active{display:flex}

/* === LOGIN === */
#login-screen{align-items:center;justify-content:center;overflow-y:auto;padding:var(--safe-top) var(--safe-right) var(--safe-bottom) var(--safe-left);background:radial-gradient(ellipse at 20% 50%,rgba(34,197,94,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 20%,rgba(34,197,94,0.04) 0%,transparent 50%),var(--bg-main)}
.login-container{width:100%;max-width:400px;padding:20px;animation:slideUp .5s ease}
.login-logo{text-align:center;margin-bottom:32px}
.login-logo .logo-icon{width:60px;height:60px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:16px;display:flex;align-items:center;justify-content:center;margin:0 auto 14px;animation:pulse-green 3s ease infinite}
.login-logo .logo-icon svg{width:30px;height:30px}
.login-logo h1{font-size:26px;font-weight:700;letter-spacing:-.5px}
.login-logo h1 span{color:var(--primary)}
.login-logo p{color:var(--text-secondary);font-size:14px;margin-top:4px}
.login-box{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:28px;box-shadow:var(--shadow-card)}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:12px;font-weight:500;color:var(--text-secondary);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px 14px;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:16px;outline:none;transition:border-color .2s,box-shadow .2s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
.form-group select{font-family:'Space Grotesk',sans-serif;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238aab8a' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:10px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:16px;font-weight:600;cursor:pointer;transition:transform .15s,box-shadow .2s;margin-top:6px;min-height:48px}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(34,197,94,0.3)}
.login-btn:active{transform:scale(0.98)}
.login-error{color:var(--red);font-size:13px;text-align:center;margin-top:10px;min-height:20px}

/* === MAIN LAYOUT === */
#main-screen{flex-direction:column;height:100%;overflow:hidden}
.top-bar{display:flex;align-items:center;justify-content:space-between;padding:10px 20px;padding-top:calc(10px + var(--safe-top));border-bottom:1px solid var(--border);background:var(--topbar-bg);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);position:relative;z-index:100;transition:background .3s;flex-shrink:0}
.top-bar-left{display:flex;align-items:center;gap:10px;min-width:0}
.top-bar-logo{width:34px;height:34px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.top-bar-logo svg{width:18px;height:18px}
.top-bar h2{font-size:17px;font-weight:600;white-space:nowrap}.top-bar h2 span{color:var(--primary)}
.top-bar-right{display:flex;align-items:center;gap:6px}
.user-badge{font-size:11px;color:var(--text-secondary);background:var(--bg-input);padding:5px 10px;border-radius:20px;border:1px solid var(--border);white-space:nowrap;max-width:140px;overflow:hidden;text-overflow:ellipsis}
.tb-btn{padding:7px 12px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:500;cursor:pointer;transition:all .15s;border:1px solid var(--border);background:transparent;color:var(--text-secondary);white-space:nowrap;min-height:34px;display:flex;align-items:center;justify-content:center}
.tb-btn:hover{border-color:var(--primary);color:var(--primary)}
.tb-btn:active{transform:scale(0.95)}
.tb-btn.logout:hover{border-color:var(--red);color:var(--red)}
.tb-btn.icon-btn{font-size:16px;padding:6px 9px;line-height:1;min-width:34px}
.lang-select{padding:6px 10px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:13px;cursor:pointer;border:1px solid var(--border);background:var(--bg-input);color:var(--text-primary);outline:none;min-width:48px;text-align:center;transition:all .15s;min-height:34px}
.lang-select:hover,.lang-select:focus{border-color:var(--primary);color:var(--primary)}
.lang-select option{background:var(--bg-card);color:var(--text-primary);padding:8px}
.main-content{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}

/* === ASSISTANTS GRID === */
.assistants-view{padding:24px 20px;padding-bottom:calc(24px + var(--safe-bottom));max-width:960px;margin:0 auto;width:100%}
.assistants-header{margin-bottom:24px;animation:fadeIn .4s ease;text-align:center}
.assistants-header h3{font-size:21px;font-weight:700;margin-bottom:4px}
.assistants-header p{color:var(--text-secondary);font-size:14px}
.assistants-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.assistant-card{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:20px;cursor:pointer;transition:all .2s ease;animation:fadeIn .4s ease backwards;position:relative;overflow:hidden;box-shadow:var(--shadow-card);-webkit-user-select:none;user-select:none}
.assistant-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),transparent);opacity:0;transition:opacity .2s}
.assistant-card:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow:0 8px 24px rgba(34,197,94,0.1)}.assistant-card:hover::before{opacity:1}
.assistant-card:active{transform:scale(0.98);transition:transform .1s}
.assistant-card-header{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.assistant-avatar{width:42px;height:42px;background:var(--primary-glow);border-radius:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.assistant-avatar svg{width:21px;height:21px;stroke:var(--primary)}
.assistant-card h4{font-size:14px;font-weight:600;line-height:1.3}
.assistant-card-desc{font-size:13px;color:var(--text-secondary);line-height:1.45;margin-bottom:12px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.assistant-card-footer{display:flex;align-items:center;justify-content:space-between}
.assistant-tag{font-size:11px;padding:3px 10px;background:var(--primary-glow);color:var(--primary);border-radius:20px;font-weight:500}
.assistant-arrow{color:var(--text-muted);transition:transform .2s}.assistant-card:hover .assistant-arrow{transform:translateX(4px);color:var(--primary)}

/* === CHAT === */
.chat-view{display:none;flex-direction:column;height:100%;max-width:800px;margin:0 auto;width:100%;padding:0 16px;overflow:hidden}
.chat-view.active{display:flex}
.chat-header{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid var(--border);flex-shrink:0}
.chat-back{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:10px;border:1px solid var(--border);cursor:pointer;background:transparent;color:var(--text-secondary);transition:all .15s;flex-shrink:0;min-height:36px}
.chat-back:hover{border-color:var(--primary);color:var(--primary)}
.chat-back:active{transform:scale(0.9)}
.chat-avatar-sm{width:38px;height:38px;background:var(--primary-glow);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chat-avatar-sm svg{width:19px;height:19px;stroke:var(--primary)}
.chat-info{min-width:0;flex:1}
.chat-info h4{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.chat-info span{font-size:11px;color:var(--text-secondary)}
.chat-header-right{margin-left:auto;display:flex;gap:6px;flex-shrink:0}
.chat-messages{flex:1;overflow-y:auto;overflow-x:hidden;padding:16px 0;display:flex;flex-direction:column;gap:10px;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;overscroll-behavior-y:contain}
.chat-messages::-webkit-scrollbar{width:3px}.chat-messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.chat-welcome{text-align:center;margin:auto;padding:32px 16px;animation:fadeIn .4s ease}
.welcome-icon{width:56px;height:56px;background:var(--primary-glow);border-radius:16px;display:flex;align-items:center;justify-content:center;margin:0 auto 14px}
.welcome-icon svg{width:28px;height:28px;stroke:var(--primary)}
.chat-welcome h3{font-size:17px;font-weight:600;margin-bottom:5px}
.chat-welcome p{color:var(--text-secondary);font-size:13px;max-width:360px;margin:0 auto;line-height:1.5}
.message{display:flex;flex-direction:column;animation:fadeIn .25s ease;max-width:88%}
.message.user{align-self:flex-end;align-items:flex-end}
.message.assistant{align-self:flex-start;align-items:flex-start}
.message-bubble{padding:10px 14px;border-radius:14px;font-size:14px;line-height:1.6;word-break:break-word}
.message.user .message-bubble{background:var(--msg-user-bg);color:var(--msg-user-text);border-bottom-right-radius:4px}
.message.assistant .message-bubble{background:var(--msg-ai-bg);color:var(--msg-ai-text);border:1px solid var(--border);border-bottom-left-radius:4px}
.message-time{font-size:10px;color:var(--text-muted);margin-top:3px;padding:0 4px}
.typing-indicator{display:none;align-self:flex-start;padding:10px 16px;background:var(--msg-ai-bg);border:1px solid var(--border);border-radius:14px;border-bottom-left-radius:4px;gap:5px;align-items:center}
.typing-indicator.active{display:flex}
.typing-dot{width:6px;height:6px;background:var(--primary);border-radius:50%;animation:typing-dot 1.2s infinite}
.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}
.chat-input-area{padding:10px 0;padding-bottom:calc(10px + var(--safe-bottom));border-top:1px solid var(--border);display:flex;gap:8px;align-items:flex-end;flex-shrink:0}
.chat-input-area textarea{flex:1;padding:11px 14px;background:var(--bg-input);border:1px solid var(--border);border-radius:12px;color:var(--text-primary);font-family:'Space Grotesk',sans-serif;font-size:16px;resize:none;outline:none;max-height:120px;min-height:44px;line-height:1.4;transition:border-color .2s}
.chat-input-area textarea:focus{border-color:var(--primary)}
.chat-send-btn{width:44px;height:44px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .1s,opacity .15s;flex-shrink:0}
.chat-send-btn:hover{transform:scale(1.05)}.chat-send-btn:active{transform:scale(0.92)}
.chat-send-btn:disabled{opacity:0.4;cursor:not-allowed;transform:none}
.chat-send-btn svg{width:20px;height:20px}

/* === API KEY BAR === */
.api-key-bar{display:none;padding:10px 14px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:10px;margin:10px 0;gap:8px;align-items:center;flex-wrap:wrap}
.api-key-bar.active{display:flex}
.api-key-bar input{flex:1;min-width:160px;padding:10px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:14px;outline:none}
.api-key-bar button{padding:10px 16px;background:var(--primary);border:none;border-radius:8px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:500;cursor:pointer;min-height:40px}

/* === ADMIN === */
.admin-view{display:none;padding:20px;padding-bottom:calc(20px + var(--safe-bottom));max-width:800px;margin:0 auto;width:100%}
.admin-view.active{display:block}
.admin-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px}
.admin-header h3{font-size:19px;font-weight:700}
.admin-add-btn{padding:10px 18px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:10px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:transform .1s;min-height:40px}
.admin-add-btn:hover{transform:translateY(-1px)}
.admin-add-btn:active{transform:scale(0.96)}
.admin-item{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;padding:16px;margin-bottom:10px;box-shadow:var(--shadow-card);transition:background .3s}
.admin-item-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.admin-item-title{display:flex;align-items:center;gap:10px;min-width:0}
.admin-icon{width:34px;height:34px;background:var(--primary-glow);border-radius:9px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.admin-icon svg{width:17px;height:17px;stroke:var(--primary)}
.admin-item h4{font-size:14px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.admin-item-actions{display:flex;gap:6px}
.admin-edit-btn,.admin-delete-btn{padding:7px 14px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:12px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--text-secondary);transition:all .15s;min-height:34px}
.admin-edit-btn:hover{border-color:var(--primary);color:var(--primary)}
.admin-edit-btn:active,.admin-delete-btn:active{transform:scale(0.95)}
.admin-delete-btn:hover{border-color:var(--red);color:var(--red)}
.admin-save-btn{padding:10px 22px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:8px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;cursor:pointer;margin-top:12px;transition:transform .1s;min-height:40px}
.admin-save-btn:hover{transform:translateY(-1px)}
.admin-save-btn:active{transform:scale(0.96)}
.admin-item-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.form-group textarea{font-family:'JetBrains Mono',monospace;font-size:14px;line-height:1.5;resize:vertical}
.icon-selector{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:4px}
.icon-option{width:38px;height:38px;border-radius:9px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s;background:var(--bg-input)}
.icon-option:hover{border-color:var(--primary)}
.icon-option:active{transform:scale(0.9)}
.icon-option.selected{border-color:var(--primary);background:var(--primary-glow)}
.icon-option svg{width:18px;height:18px;stroke:var(--primary)}

/* === MODAL === */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.active{display:flex}
.modal-box{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:24px;max-width:360px;width:100%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:slideUp .25s ease}
.modal-box h4{font-size:16px;font-weight:600;margin-bottom:6px}
.modal-box p{font-size:13px;color:var(--text-secondary);margin-bottom:18px}
.modal-actions{display:flex;gap:10px;justify-content:center}
.modal-actions button{padding:10px 22px;border-radius:10px;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:500;cursor:pointer;border:1px solid var(--border);transition:all .15s;min-height:40px}
.modal-actions button:active{transform:scale(0.95)}
.modal-cancel{background:transparent;color:var(--text-secondary)}
.modal-cancel:hover{border-color:var(--text-secondary)}
.modal-delete{background:var(--red);color:#fff;border-color:var(--red)}
.modal-delete:hover{opacity:0.9}

/* === TOAST === */
.toast{position:fixed;bottom:calc(24px + var(--safe-bottom));left:50%;transform:translateX(-50%) translateY(80px);background:var(--bg-card);border:1px solid var(--primary);color:var(--text-primary);padding:10px 20px;border-radius:10px;font-size:13px;font-weight:500;z-index:300;box-shadow:0 8px 24px rgba(0,0,0,0.3);transition:transform .25s ease;pointer-events:none}
.toast.active{transform:translateX(-50%) translateY(0)}

/* === QUICK PROMPTS === */
.quick-prompts{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:16px}
.quick-prompt{padding:8px 16px;background:var(--bg-input);border:1px solid var(--border);border-radius:20px;font-family:'Space Grotesk',sans-serif;font-size:13px;color:var(--text-secondary);cursor:pointer;transition:all .15s;white-space:nowrap}
.quick-prompt:hover{border-color:var(--primary);color:var(--primary);background:var(--primary-glow)}
.quick-prompt:active{transform:scale(0.95)}
.start-btn{display:inline-flex;align-items:center;gap:8px;margin-top:20px;padding:14px 32px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:12px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:transform .15s,box-shadow .2s;box-shadow:0 4px 16px rgba(34,197,94,0.25)}
.start-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(34,197,94,0.35)}
.start-btn:active{transform:scale(0.96)}

/* ========== RESPONSIVE ========== */

/* MOBILE: 0-479px (phones portrait) */
@media(max-width:479px){
.top-bar{padding:8px 12px;padding-top:calc(8px + var(--safe-top))}
.top-bar-logo{width:30px;height:30px;border-radius:8px}
.top-bar-logo svg{width:16px;height:16px}
.top-bar h2{font-size:15px}
.top-bar-right{gap:3px}
.user-badge{display:none}
.tb-btn{padding:6px 8px;font-size:11px;min-height:30px}
.tb-btn.icon-btn{font-size:14px;padding:5px 7px;min-width:30px;min-height:30px}
.lang-select{font-size:13px;padding:5px 6px;min-width:34px;min-height:30px}
.assistants-view{padding:16px 12px;padding-bottom:calc(16px + var(--safe-bottom))}
.assistants-header{margin-bottom:16px}
.assistants-header h3{font-size:18px}
.assistants-header p{font-size:13px}
.assistants-grid{grid-template-columns:1fr;gap:10px}
.assistant-card{padding:16px;border-radius:12px}
.assistant-card-header{gap:10px;margin-bottom:8px}
.assistant-avatar{width:38px;height:38px;border-radius:10px}
.assistant-avatar svg{width:19px;height:19px}
.assistant-card h4{font-size:14px}
.assistant-card-desc{font-size:12px;margin-bottom:10px}
.chat-view{padding:0 10px}
.chat-header{gap:10px;padding:10px 0}
.chat-back{width:32px;height:32px;min-height:32px;border-radius:8px}
.chat-avatar-sm{width:34px;height:34px;border-radius:9px}
.chat-avatar-sm svg{width:17px;height:17px}
.chat-info h4{font-size:13px}
.chat-messages{padding:12px 0;gap:8px}
.message{max-width:92%}
.message-bubble{padding:9px 12px;font-size:14px;border-radius:12px;line-height:1.55}
.message.user .message-bubble{border-bottom-right-radius:3px}
.message.assistant .message-bubble{border-bottom-left-radius:3px}
.chat-input-area{padding:8px 0;padding-bottom:calc(8px + var(--safe-bottom));gap:6px}
.chat-input-area textarea{padding:10px 12px;border-radius:10px;min-height:40px;font-size:16px}
.chat-send-btn{width:40px;height:40px;border-radius:10px}
.start-btn{padding:12px 24px;font-size:14px;border-radius:10px}
.admin-view{padding:14px 12px;padding-bottom:calc(14px + var(--safe-bottom))}
.admin-item{padding:14px;border-radius:10px}
.admin-item-row{grid-template-columns:1fr}
.admin-item h4{font-size:13px}
.icon-option{width:34px;height:34px;border-radius:8px}
.icon-option svg{width:16px;height:16px}
.login-container{padding:16px}
.login-logo{margin-bottom:24px}
.login-logo .logo-icon{width:52px;height:52px;border-radius:14px}
.login-logo .logo-icon svg{width:26px;height:26px}
.login-logo h1{font-size:24px}
.login-box{padding:22px 18px;border-radius:14px}
.modal-box{padding:20px;border-radius:14px}
}

/* MOBILE LANDSCAPE + SMALL TABLETS: 480-767px */
@media(min-width:480px) and (max-width:767px){
.top-bar{padding:10px 16px;padding-top:calc(10px + var(--safe-top))}
.user-badge{display:none}
.assistants-grid{grid-template-columns:repeat(2,1fr);gap:10px}
.assistant-card{padding:18px}
.chat-view{padding:0 14px}
.admin-item-row{grid-template-columns:1fr 1fr}
}

/* TABLETS: 768-1023px */
@media(min-width:768px) and (max-width:1023px){
.top-bar{padding:12px 24px}
.assistants-view{padding:28px 24px}
.assistants-grid{grid-template-columns:repeat(2,1fr);gap:14px}
.assistant-card{padding:20px}
.chat-view{padding:0 20px}
.admin-view{padding:24px}
}

/* DESKTOP: 1024-1439px */
@media(min-width:1024px){
.assistants-view{padding:32px 32px;max-width:1000px}
.assistants-grid{grid-template-columns:repeat(3,1fr);gap:14px}
.chat-view{max-width:840px;padding:0 24px}
.admin-view{max-width:860px;padding:28px 32px}
.top-bar{padding:12px 32px}
}

/* WIDESCREEN: 1440px+ */
@media(min-width:1440px){
.assistants-view{max-width:1100px;padding:40px 40px}
.assistants-grid{grid-template-columns:repeat(3,1fr);gap:16px}
.assistant-card{padding:24px}
.chat-view{max-width:900px}
.admin-view{max-width:900px}
}

/* HOVER DEVICE — disable hover effects on touch */
@media(hover:none){
.assistant-card:hover{transform:none;border-color:var(--border);box-shadow:var(--shadow-card)}
.assistant-card:hover::before{opacity:0}
.tb-btn:hover{border-color:var(--border);color:var(--text-secondary)}
.tb-btn.logout:hover{border-color:var(--border);color:var(--text-secondary)}
}

/* LANDSCAPE PHONE — prevent keyboard overlap */
@media(max-height:500px) and (orientation:landscape){
.chat-welcome{padding:16px 12px}
.welcome-icon{width:40px;height:40px;border-radius:12px;margin-bottom:8px}
.welcome-icon svg{width:20px;height:20px}
.chat-welcome h3{font-size:15px}
.chat-welcome p{font-size:12px}
.chat-header{padding:6px 0}
.chat-input-area{padding:6px 0;padding-bottom:calc(6px + var(--safe-bottom))}
.login-logo{margin-bottom:12px}
.login-logo .logo-icon{width:40px;height:40px}
.login-logo h1{font-size:20px}
.login-box{padding:16px}
}
</style>
</head>
<body>
<div id="login-screen" class="screen active">
<div class="login-container">
<div class="login-logo">
<div class="logo-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
<h1>TALKO <span>AI</span></h1>
<p data-i18n="login_subtitle">AI-асистенти для вашого бізнесу</p>
</div>
<div class="login-box">
<div style="display:flex;justify-content:flex-end;margin-bottom:12px"><select class="lang-select" id="login-lang-select" title="Language"><option value="uk">UA</option><option value="ru">RU</option><option value="en">EN</option></select></div>
<div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="email@company.com"></div>
<div class="form-group"><label data-i18n="password">Пароль</label><input type="password" id="login-password" placeholder="••••••••"></div>
<button class="login-btn" id="login-btn" data-i18n="login_btn">Увійти</button>
<div class="login-error" id="login-error"></div>
</div>
</div>
</div>
<div id="main-screen" class="screen">
<div class="top-bar">
<div class="top-bar-left">
<div class="top-bar-logo"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
<h2>TALKO <span>AI</span></h2>
</div>
<div class="top-bar-right">
<span class="user-badge" id="user-email"></span>
<select class="lang-select" id="lang-select" title="Language"><option value="uk">UA</option><option value="ru">RU</option><option value="en">EN</option></select>
<button class="tb-btn icon-btn" id="theme-toggle" title="Theme"><svg id="theme-icon-moon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><svg id="theme-icon-sun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button>
<button class="tb-btn" id="admin-toggle" style="display:none" data-i18n="admin_btn">Адмін</button>
<button class="tb-btn logout" id="logout-btn" data-i18n="logout_btn">Вийти</button>
</div>
</div>
<div style="max-width:800px;margin:0 auto;width:100%;padding:0 20px;flex-shrink:0">
<div class="api-key-bar" id="api-key-bar">
<span style="font-size:13px;color:var(--red);font-weight:500"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-2px;margin-right:4px"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>OpenAI API:</span>
<input type="password" id="api-key-input" placeholder="sk-...">
<button id="api-key-save" data-i18n="save_btn">Зберегти</button>
</div>
</div>
<div class="main-content" id="main-content">
<div class="assistants-view" id="assistants-view">
<div class="assistants-header">
<h3 data-i18n="assistants_title">Ваші AI-асистенти</h3>
<p data-i18n="assistants_subtitle">Оберіть асистента для вирішення бізнес-задач</p>
</div>
<div class="assistants-grid" id="assistants-grid"></div>
</div>
<div class="chat-view" id="chat-view">
<div class="chat-header">
<button class="chat-back" id="chat-back"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
<div class="chat-avatar-sm" id="chat-avatar"></div>
<div class="chat-info"><h4 id="chat-name"></h4><span id="chat-desc"></span></div>
<div class="chat-header-right"><button class="tb-btn" id="chat-clear" data-i18n="clear_chat">Очистити</button></div>
</div>
<div class="chat-messages" id="chat-messages"></div>
<div class="typing-indicator" id="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
<div class="chat-input-area">
<textarea id="chat-input" data-i18n-placeholder="chat_placeholder" placeholder="Напишіть повідомлення..." rows="1"></textarea>
<button class="chat-send-btn" id="chat-send"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
</div>
</div>
<div class="admin-view" id="admin-view">
<div class="admin-header"><h3 data-i18n="admin_title">Управління асистентами</h3><button class="admin-add-btn" id="admin-add-btn">+ <span data-i18n="add_btn">Додати</span></button></div>
<div id="admin-list"></div>
</div>
</div><!-- /main-content -->
</div>
<div class="modal-overlay" id="delete-modal">
<div class="modal-box">
<h4 data-i18n="delete_title">Видалити асистента?</h4>
<p data-i18n="delete_desc">Цю дію неможливо скасувати</p>
<div class="modal-actions">
<button class="modal-cancel" id="delete-cancel" data-i18n="cancel_btn">Скасувати</button>
<button class="modal-delete" id="delete-confirm" data-i18n="delete_btn">Видалити</button>
</div>
</div>
</div>
<div class="toast" id="toast"></div>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
// ===== i18n =====
const I18N={
uk:{login_subtitle:'AI-асистенти для вашого бізнесу',password:'Пароль',login_btn:'Увійти',admin_btn:'Адмін',logout_btn:'Вийти',save_btn:'Зберегти',assistants_title:'Ваші AI-асистенти',assistants_subtitle:'Оберіть асистента для вирішення бізнес-задач',admin_title:'Управління асистентами',add_btn:'Додати',delete_title:'Видалити асистента?',delete_desc:'Цю дію неможливо скасувати',cancel_btn:'Скасувати',delete_btn:'Видалити',clear_chat:'Очистити',chat_placeholder:'Напишіть повідомлення...',no_api_key:'API ключ не налаштований. Зверніться до адміністратора.',error_msg:'Помилка. Перевірте API ключ або спробуйте ще раз.',no_reply:'Немає відповіді.',login_error:'Невірний email або пароль',fill_fields:'Введіть email та пароль',saved:'Збережено',error:'Помилка',edit_btn:'Редагувати',name_label:'Назва',icon_label:'Іконка',tag_label:'Тег',model_label:'Модель',desc_label:'Опис',welcome_label:'Привітання',prompt_label:'Системний промпт',order_label:'Порядок',or_try:'або спробуйте:',start_btn:'▶ Запустити асистента'},
ru:{login_subtitle:'AI-ассистенты для вашего бизнеса',password:'Пароль',login_btn:'Войти',admin_btn:'Админ',logout_btn:'Выйти',save_btn:'Сохранить',assistants_title:'Ваши AI-ассистенты',assistants_subtitle:'Выберите ассистента для решения бизнес-задач',admin_title:'Управление ассистентами',add_btn:'Добавить',delete_title:'Удалить ассистента?',delete_desc:'Это действие нельзя отменить',cancel_btn:'Отмена',delete_btn:'Удалить',clear_chat:'Очистить',chat_placeholder:'Напишите сообщение...',no_api_key:'API ключ не настроен. Обратитесь к администратору.',error_msg:'Ошибка. Проверьте API ключ или попробуйте снова.',no_reply:'Нет ответа.',login_error:'Неверный email или пароль',fill_fields:'Введите email и пароль',saved:'Сохранено',error:'Ошибка',edit_btn:'Редактировать',name_label:'Название',icon_label:'Иконка',tag_label:'Тег',model_label:'Модель',desc_label:'Описание',welcome_label:'Приветствие',prompt_label:'Системный промпт',order_label:'Порядок',or_try:'или попробуйте:',start_btn:'▶ Запустить ассистента'},
en:{login_subtitle:'AI assistants for your business',password:'Password',login_btn:'Sign In',admin_btn:'Admin',logout_btn:'Sign Out',save_btn:'Save',assistants_title:'Your AI Assistants',assistants_subtitle:'Choose an assistant to solve business tasks',admin_title:'Manage Assistants',add_btn:'Add',delete_title:'Delete assistant?',delete_desc:'This action cannot be undone',cancel_btn:'Cancel',delete_btn:'Delete',clear_chat:'Clear',chat_placeholder:'Type a message...',no_api_key:'API key not configured. Contact administrator.',error_msg:'Error. Check API key or try again.',no_reply:'No response.',login_error:'Invalid email or password',fill_fields:'Enter email and password',saved:'Saved',error:'Error',edit_btn:'Edit',name_label:'Name',icon_label:'Icon',tag_label:'Tag',model_label:'Model',desc_label:'Description',welcome_label:'Welcome',prompt_label:'System prompt',order_label:'Order',or_try:'or try:',start_btn:'▶ Start Assistant'}
};
let currentLang='uk';
function t(key){return(I18N[currentLang]&&I18N[currentLang][key])||I18N.uk[key]||key}
function applyI18n(){
document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');if(I18N[currentLang]&&I18N[currentLang][k])el.textContent=I18N[currentLang][k]});
document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{const k=el.getAttribute('data-i18n-placeholder');if(I18N[currentLang]&&I18N[currentLang][k])el.placeholder=I18N[currentLang][k]});
}
function initLang(){
const saved=localStorage.getItem('talko-lang')||'uk';
currentLang=saved;
document.documentElement.setAttribute('data-lang',saved);
document.documentElement.setAttribute('lang',saved==='uk'?'uk':saved==='ru'?'ru':'en');
document.getElementById('lang-select').value=saved;
document.getElementById('login-lang-select').value=saved;
applyI18n();
}
function switchLang(lang){
currentLang=lang;
localStorage.setItem('talko-lang',currentLang);
document.documentElement.setAttribute('data-lang',currentLang);
document.documentElement.setAttribute('lang',currentLang==='uk'?'uk':currentLang==='ru'?'ru':'en');
// Sync both selects
document.getElementById('lang-select').value=lang;
document.getElementById('login-lang-select').value=lang;
applyI18n();
if(typeof isAdmin!=='undefined'&&isAdmin&&typeof currentView!=='undefined'&&currentView==='admin')renderAdminList();
}
['lang-select','login-lang-select'].forEach(id=>{
const el=document.getElementById(id);
el.addEventListener('change',function(){switchLang(this.value)});
el.addEventListener('input',function(){switchLang(this.value)});
});

// ===== ICONS =====
const ICONS={
analytics:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h7"/><path d="M16 19l2 2 4-4"/><path d="M9 10h1"/><path d="M14 10h1"/><path d="M9 14h1"/></svg>`,
people:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>`,
target:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
finance:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>`,
medical:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`,
chart:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`,
pencil:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.83 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>`,
clipboard:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/></svg>`,
scale:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3l5 9h-10l5-9z"/><path d="M8 3l5 9H3l5-9z"/><line x1="12" y1="3" x2="12" y2="21"/><line x1="3" y1="21" x2="21" y2="21"/></svg>`,
cpu:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 14h3M1 9h3M1 14h3"/></svg>`,
bolt:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
message:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>`,
globe:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10A15.3 15.3 0 0112 2z"/></svg>`,
shield:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
settings:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>`
};
const ICON_KEYS=Object.keys(ICONS);
function getIcon(name){return ICONS[name]||ICONS.bolt}

// ===== CONFIG =====
const FIREBASE_CONFIG={apiKey:"AIzaSyC74r_H2PVTPP4QdJXGRbqKvtcKCDJNoh4",authDomain:"ai-assistant-platform-e77ee.firebaseapp.com",projectId:"ai-assistant-platform-e77ee",storageBucket:"ai-assistant-platform-e77ee.firebasestorage.app",messagingSenderId:"342266457067",appId:"1:342266457067:web:a667b0593183a70fd8c7ae"};
const ADMIN_EMAIL="management.talco@gmail.com";
firebase.initializeApp(FIREBASE_CONFIG);
const auth=firebase.auth(),db=firebase.firestore();
let currentUser=null,isAdmin=false,currentAssistant=null,chatHistory={},openaiKey='',assistantsData=[];
// ── Cloud Function URL (replace YOUR-PROJECT-ID after deploy) ──
const CHAT_FUNCTION_URL='https://chat-342266457067.europe-west1.run.app';

const DEFAULT_ASSISTANTS=[
{name:"Генератор розпоряджень",icon:"clipboard",description:"Генерує чіткі розпорядження за 30 секунд. Підлеглі перестануть перепитувати",tag:"Управління",model:"gpt-5.2",prompt:"Ти — AI-асистент TALKO System 'Генератор чітких розпоряджень'. Твоя задача — перетворювати нечіткі побажання керівника у структуроване розпорядження.\n\nФОРМАТ РОЗПОРЯДЖЕННЯ:\n1. ЗАДАЧА: (що конкретно зробити — одне речення)\n2. РЕЗУЛЬТАТ: (що має бути на виході — вимірюваний продукт)\n3. ДЕДЛАЙН: (конкретна дата та час)\n4. ВІДПОВІДАЛЬНИЙ: (хто виконує)\n5. РЕСУРСИ: (що потрібно для виконання)\n6. КОНТРОЛЬНЕ ПИТАННЯ: (як перевірити що зроблено правильно)\n7. ЩО РОБИТИ ЯКЩО: (якщо виникне проблема — до кого звертатись)\n\nПРАВИЛА:\n- Завжди перепитуй якщо не вистачає інформації\n- Використовуй конкретні дієслова: 'підготувати', 'надіслати', 'зібрати'\n- Результат завжди вимірюваний: документ, файл, звіт, список\n- Якщо керівник каже розмито — запропонуй 2-3 варіанти конкретизації\n- Відповідай мовою користувача",welcome:"Опишіть задачу — я сформую чітке розпорядження за 30 секунд.",order:0},
{name:"Технічний асистент",icon:"settings",description:"Покрокові інструкції для виконання будь-яких технічних завдань",tag:"Техпідтримка",model:"gpt-5.2",prompt:"Ти — Технічний асистент TALKO System. Даєш покрокові інструкції для технічних завдань.\n\nПРАВИЛА:\n1. Починай з уточнення: що зробити, поточний стан, інструменти\n2. Покрокова інструкція — кожен крок = одна дія\n3. Після 3-5 кроків — контрольна точка\n4. Обирай найпростіший спосіб\n5. В кінці — чекліст перевірки\n6. Використовуй web search для актуальної інформації\n7. Відповідай мовою користувача",welcome:"Опишіть технічне завдання — я дам покрокову інструкцію.",order:1},
{name:"Направляючі форми",icon:"chart",description:"Структуровані бізнес-процеси з етапами, відповідальними та контрольними точками",tag:"Процеси",model:"gpt-5.2",prompt:"Ти — AI-асистент TALKO System для створення Направляючих форм.\n\nНАПРАВЛЯЮЧА ФОРМА = бізнес-процес з функцій.\n\nСТРУКТУРА ЕТАПУ:\n1. НАЗВА\n2. ВІДПОВІДАЛЬНИЙ (посада)\n3. ДЕДЛАЙН\n4. КОНТРОЛЬНЕ ПИТАННЯ (так/ні)\n5. ПРОДУКТ/РЕЗУЛЬТАТ\n\n5-15 етапів, web search для практик. Відповідай мовою користувача.",welcome:"Яку Направляючу форму створити? Вкажіть сферу та процес.",order:2},
{name:"Фінансовий директор",icon:"finance",description:"P&L, cashflow, маржинальність, точка беззбитковості, бюджетування",tag:"Фінанси",model:"gpt-5.2",prompt:"Ти — фінансовий директор TALKO System. Аналізуєш фінанси: P&L, cashflow, маржинальність, точка беззбитковості. Відповідай мовою користувача.",welcome:"Яке фінансове питання розібрати?",order:3},
{name:"Медичний консультант",icon:"medical",description:"Спеціалізований асистент для медичних клінік: маркетинг, процеси, пацієнтопотік",tag:"Медицина",model:"gpt-5.2",prompt:"Ти — консультант TALKO System для медичних клінік. Специфіка: пацієнтопотік, LTV, конверсія. Відповідай мовою користувача.",welcome:"Яке питання по клініці?",order:4},
{name:"Продажник",icon:"target",description:"Скрипти продажів, робота із запереченнями, підвищення конверсії",tag:"Продажі",model:"gpt-5.2",prompt:"Ти — тренер з продажів TALKO System. Скрипти, заперечення, конверсія. Відповідай мовою користувача.",welcome:"Що продаєте і яка проблема?",order:5},
{name:"Контент-мейкер",icon:"pencil",description:"Тексти для соцмереж, email-розсилки, лендінги, рекламні креативи",tag:"Контент",model:"gpt-5.2",prompt:"Ти — контент-мейкер TALKO System. Продаючі тексти: пости, email, лендінги, креативи. Відповідай мовою користувача.",welcome:"Який текст потрібен?",order:6},
{name:"Проджект-менеджер",icon:"clipboard",description:"Планування проєктів, декомпозиція задач, контроль дедлайнів",tag:"Управління",model:"gpt-5.2",prompt:"Ти — проджект-менеджер TALKO System. Декомпозиція, пріоритети, дедлайни. Відповідай мовою користувача.",welcome:"Який проєкт спланувати?",order:7},
{name:"Юридичний радник",icon:"scale",description:"Договори, ФОП/ТОВ, податки, захист бізнесу",tag:"Юридика",model:"gpt-5.2",prompt:"Ти — юридичний радник TALKO System. ФОП/ТОВ, податки, договори. Відповідай мовою користувача.",welcome:"Яке юридичне питання?",order:8},
{name:"AI-інтегратор",icon:"cpu",description:"Впровадження AI в бізнес: автоматизація, чат-боти, аналітика",tag:"AI",model:"gpt-5.2",prompt:"Ти — AI-інтегратор TALKO System. Чат-боти, автоматизація, AI-аналітика. Відповідай мовою користувача.",welcome:"Який процес автоматизувати?",order:9}
];

// ===== THEME =====
function setTheme(th){
document.documentElement.setAttribute('data-theme',th);localStorage.setItem('talko-theme',th);
const m=document.getElementById('meta-theme');if(m)m.content=th==='dark'?'#0a0f0a':'#f0f5ee';
document.getElementById('theme-icon-moon').style.display=th==='dark'?'block':'none';
document.getElementById('theme-icon-sun').style.display=th==='light'?'block':'none';
}
function initTheme(){setTheme(localStorage.getItem('talko-theme')||'dark')}
document.getElementById('theme-toggle').addEventListener('click',()=>{setTheme(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')});
initTheme();initLang();

// ===== MOBILE KEYBOARD =====
if(window.visualViewport){let rAF=null;
window.visualViewport.addEventListener('resize',()=>{if(rAF)cancelAnimationFrame(rAF);rAF=requestAnimationFrame(()=>{document.body.style.height=window.visualViewport.height+'px';const diff=window.innerHeight-window.visualViewport.height;if(diff>100)setTimeout(()=>scrollToBottom(),150)})});
window.visualViewport.addEventListener('scroll',()=>{window.scrollTo(0,0)});
}

// ===== TOAST =====
function showToast(msg){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('active');setTimeout(()=>el.classList.remove('active'),2500)}

// ===== AUTH =====
auth.onAuthStateChanged(async(user)=>{
if(user){currentUser=user;isAdmin=user.email===ADMIN_EMAIL;
document.getElementById('login-screen').classList.remove('active');
document.getElementById('main-screen').classList.add('active');
document.getElementById('user-email').textContent=user.email;
if(isAdmin){document.getElementById('admin-toggle').style.display='';
try{const c=await db.collection('config').doc('openai').get();if(c.exists)openaiKey=c.data().apiKey||''}catch(e){}
if(!openaiKey)document.getElementById('api-key-bar').classList.add('active');
}
await loadAssistants();
}else{currentUser=null;isAdmin=false;
document.getElementById('login-screen').classList.add('active');
document.getElementById('main-screen').classList.remove('active')}
});
document.getElementById('login-btn').addEventListener('click',async()=>{
const e=document.getElementById('login-email').value.trim(),p=document.getElementById('login-password').value,err=document.getElementById('login-error');
err.textContent='';if(!e||!p){err.textContent=t('fill_fields');return}
try{await auth.signInWithEmailAndPassword(e,p)}catch(x){err.textContent=t('login_error')}
});
document.getElementById('login-password').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('login-btn').click()});
document.getElementById('login-email').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('login-password').focus()});
document.getElementById('logout-btn').addEventListener('click',()=>{auth.signOut();chatHistory={}});
document.getElementById('api-key-save').addEventListener('click',async()=>{
const k=document.getElementById('api-key-input').value.trim();if(!k)return;
try{await db.collection('config').doc('openai').set({apiKey:k});openaiKey=k;document.getElementById('api-key-bar').classList.remove('active');showToast(t('saved'))}catch(e){alert(t('error'))}
});

// ===== ASSISTANTS =====
const SEED_VERSION='v5';
async function loadAssistants(){
try{
let needReseed=false;
try{const vDoc=await db.collection('config').doc('seed_version').get();if(!vDoc.exists||vDoc.data().version!==SEED_VERSION)needReseed=true}catch(e){needReseed=true}
if(needReseed&&isAdmin){
const old=await db.collection('assistants').get();const batch=db.batch();old.docs.forEach(d=>batch.delete(d.ref));await batch.commit();
for(const a of DEFAULT_ASSISTANTS)await db.collection('assistants').add(a);
await db.collection('config').doc('seed_version').set({version:SEED_VERSION});
}
const s=await db.collection('assistants').orderBy('order').get();
if(s.empty){for(const a of DEFAULT_ASSISTANTS)await db.collection('assistants').add(a);return loadAssistants()}
assistantsData=s.docs.map(d=>({id:d.id,...d.data()}));renderAssistants();if(isAdmin)renderAdminList();
}catch(e){console.error('Load error:',e)}
}

function renderAssistants(){
const g=document.getElementById('assistants-grid');
g.innerHTML=assistantsData.map((a,i)=>`<div class="assistant-card" data-id="${a.id}" style="animation-delay:${i*0.06}s">
<div class="assistant-card-header"><div class="assistant-avatar">${getIcon(a.icon||'bolt')}</div><h4>${a.name}</h4></div>
<div class="assistant-card-desc">${a.description||''}</div>
<div class="assistant-card-footer"><span class="assistant-tag">${a.tag||'AI'}</span><span class="assistant-arrow"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg></span></div>
</div>`).join('');
g.querySelectorAll('.assistant-card').forEach(c=>c.addEventListener('click',()=>openChat(c.dataset.id)));
}

// ===== QUICK PROMPTS PER ASSISTANT =====
const QUICK_PROMPTS={
uk:{clipboard:['Поставити задачу менеджеру','Написати розпорядження для бухгалтера','Делегувати задачу команді'],settings:['Як налаштувати CRM','Інструкція для нового співробітника','Чекліст запуску проєкту'],chart:['Процес обробки замовлення','Адаптація нового працівника','Процес роботи з клієнтом'],finance:['Розрахувати точку беззбитковості','Аналіз витрат за місяць','Прогноз cashflow'],medical:['Збільшити конверсію дзвінків','Підняти LTV пацієнтів','Зменшити відтік пацієнтів'],target:['Скрипт для холодного дзвінка','Відповідь на заперечення "дорого"','Скрипт для месенджера'],pencil:['Пост для Instagram','Email для бази клієнтів','Текст для лендінгу'],scale:['Договір з підрядником','Різниця ФОП vs ТОВ','Захист бізнесу при партнерстві'],cpu:['Чат-бот для Telegram','Автоматизація звітності','AI для аналізу відгуків']},
ru:{clipboard:['Поставить задачу менеджеру','Написать распоряжение','Делегировать задачу'],settings:['Как настроить CRM','Инструкция для сотрудника','Чеклист запуска проекта'],chart:['Процесс обработки заказа','Адаптация сотрудника','Процесс работы с клиентом'],finance:['Рассчитать точку безубыточности','Анализ расходов','Прогноз cashflow'],medical:['Увеличить конверсию звонков','Поднять LTV пациентов','Уменьшить отток пациентов'],target:['Скрипт для холодного звонка','Ответ на возражение "дорого"','Скрипт для мессенджера'],pencil:['Пост для Instagram','Email для базы клиентов','Текст для лендинга'],scale:['Договор с подрядчиком','Разница ФЛП vs ООО','Защита бизнеса'],cpu:['Чат-бот для Telegram','Автоматизация отчётности','AI для аналитики']},
en:{clipboard:['Assign a task to manager','Write a directive','Delegate a task'],settings:['How to set up CRM','Instructions for new employee','Project launch checklist'],chart:['Order processing workflow','Employee onboarding','Client management process'],finance:['Calculate break-even point','Monthly expense analysis','Cashflow forecast'],medical:['Increase call conversion','Raise patient LTV','Reduce patient churn'],target:['Cold call script','Handle "too expensive" objection','Messenger sales script'],pencil:['Instagram post','Email for client base','Landing page copy'],scale:['Contractor agreement','Sole proprietor vs LLC','Business partnership protection'],cpu:['Telegram chatbot','Reporting automation','AI for review analysis']}
};
function getQuickPrompts(icon){return(QUICK_PROMPTS[currentLang]&&QUICK_PROMPTS[currentLang][icon])||QUICK_PROMPTS.uk[icon]||['Допоможи мені','Що ти вмієш?','Почнемо']}

// ===== CHAT =====
function openChat(id){
currentAssistant=assistantsData.find(a=>a.id===id);if(!currentAssistant)return;
document.getElementById('assistants-view').style.display='none';
document.getElementById('admin-view').classList.remove('active');
document.getElementById('chat-view').classList.add('active');
document.getElementById('chat-avatar').innerHTML=getIcon(currentAssistant.icon||'bolt');
document.getElementById('chat-name').textContent=currentAssistant.name;
document.getElementById('chat-desc').textContent=currentAssistant.tag||'';
const m=document.getElementById('chat-messages');m.innerHTML='';
if(!chatHistory[id]||!chatHistory[id].length){
renderWelcome(m);
}else{chatHistory[id].forEach(msg=>appendMessage(msg.role,msg.content,false));scrollToBottom()}
document.getElementById('chat-input').focus();
}
function renderWelcome(container){
if(!currentAssistant)return;
const qp=getQuickPrompts(currentAssistant.icon||'bolt');
container.innerHTML=`<div class="chat-welcome">
<div class="welcome-icon">${getIcon(currentAssistant.icon||'bolt')}</div>
<h3>${currentAssistant.name}</h3>
<p>${currentAssistant.welcome||'...'}</p>
<button class="start-btn" onclick="startAssistant()">${t('start_btn')}</button>
</div>`;
}
window.startAssistant=function(){
if(!currentAssistant)return;
const startMsg=currentAssistant.welcome||'Почни роботу';
if(!chatHistory[currentAssistant.id])chatHistory[currentAssistant.id]=[];
chatHistory[currentAssistant.id].push({role:'user',content:startMsg});
const m=document.getElementById('chat-messages');
const w=m.querySelector('.chat-welcome');if(w)w.remove();
document.getElementById('chat-send').disabled=true;showTyping(true);
(async()=>{
try{
const idToken=await firebase.auth().currentUser.getIdToken();
const r=await fetch(CHAT_FUNCTION_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({assistantId:currentAssistant.id,messages:chatHistory[currentAssistant.id].map(msg=>({role:msg.role,content:msg.content})),idToken})});
if(!r.ok){const err=await r.json().catch(()=>({}));throw new Error(err.detail||err.error||`Error ${r.status}`)}
const data=await r.json();
const reply=data.reply||t('no_reply');
chatHistory[currentAssistant.id].push({role:'assistant',content:reply});showTyping(false);appendMessage('assistant',reply);
}catch(e){showTyping(false);chatHistory[currentAssistant.id].pop();appendMessage('assistant',t('error_msg'));console.error(e)}
document.getElementById('chat-send').disabled=false;
})();
};
window.quickSend=function(btn){document.getElementById('chat-input').value=btn.textContent;sendMessage()};
function closeChat(){document.getElementById('chat-view').classList.remove('active');document.getElementById('assistants-view').style.display='';currentAssistant=null}
document.getElementById('chat-back').addEventListener('click',closeChat);
document.getElementById('chat-clear').addEventListener('click',()=>{
if(!currentAssistant)return;
chatHistory[currentAssistant.id]=[];
const m=document.getElementById('chat-messages');m.innerHTML='';
renderWelcome(m);
});

function appendMessage(role,content,animate=true){
const m=document.getElementById('chat-messages'),w=m.querySelector('.chat-welcome');if(w)w.remove();
const d=document.createElement('div');d.className=`message ${role==='user'?'user':'assistant'}`;
if(!animate)d.style.animation='none';
const tm=new Date().toLocaleTimeString('uk-UA',{hour:'2-digit',minute:'2-digit'});
let h=escapeHtml(content);
h=h.replace(/\n/g,'<br>');
h=h.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
h=h.replace(/`([^`]+)`/g,'<code style="background:var(--primary-glow);padding:2px 6px;border-radius:4px;font-family:JetBrains Mono,monospace;font-size:12px">$1</code>');
d.innerHTML=`<div class="message-bubble">${h}</div><div class="message-time">${tm}</div>`;
m.appendChild(d);scrollToBottom();
}
function escapeHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}
function scrollToBottom(){const e=document.getElementById('chat-messages');e.scrollTop=e.scrollHeight}
function showTyping(s){const e=document.getElementById('typing-indicator');e.classList.toggle('active',s);if(s)scrollToBottom()}

async function sendMessage(){
const input=document.getElementById('chat-input'),text=input.value.trim();if(!text||!currentAssistant)return;
input.value='';input.style.height='auto';appendMessage('user',text);
if(!chatHistory[currentAssistant.id])chatHistory[currentAssistant.id]=[];
chatHistory[currentAssistant.id].push({role:'user',content:text});
document.getElementById('chat-send').disabled=true;showTyping(true);
try{
const idToken=await firebase.auth().currentUser.getIdToken();
const r=await fetch(CHAT_FUNCTION_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({assistantId:currentAssistant.id,messages:chatHistory[currentAssistant.id].map(m=>({role:m.role,content:m.content})),idToken})});
if(!r.ok){const err=await r.json().catch(()=>({}));throw new Error(err.detail||err.error||`Error ${r.status}`)}
const data=await r.json();
const reply=data.reply||t('no_reply');
chatHistory[currentAssistant.id].push({role:'assistant',content:reply});showTyping(false);appendMessage('assistant',reply);
}catch(e){showTyping(false);chatHistory[currentAssistant.id].pop();appendMessage('assistant',t('error_msg'));console.error(e)}
document.getElementById('chat-send').disabled=false;input.focus();
}
document.getElementById('chat-send').addEventListener('click',sendMessage);
document.getElementById('chat-input').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});
document.getElementById('chat-input').addEventListener('input',function(){this.style.height='auto';this.style.height=Math.min(this.scrollHeight,150)+'px'});

// ===== ADMIN =====
let currentView='assistants';
document.getElementById('admin-toggle').addEventListener('click',()=>{
if(currentView==='admin'){document.getElementById('admin-view').classList.remove('active');document.getElementById('assistants-view').style.display='';document.getElementById('chat-view').classList.remove('active');document.getElementById('admin-toggle').textContent=t('admin_btn');currentView='assistants'}
else{document.getElementById('admin-view').classList.add('active');document.getElementById('assistants-view').style.display='none';document.getElementById('chat-view').classList.remove('active');document.getElementById('admin-toggle').textContent='← '+t('admin_btn');currentView='admin';renderAdminList()}
});

function renderIconSelector(sel,inputId){
return `<div class="icon-selector">${ICON_KEYS.map(k=>`<div class="icon-option ${k===sel?'selected':''}" data-icon="${k}" onclick="selectIcon('${inputId}','${k}')">${ICONS[k]}</div>`).join('')}</div><input type="hidden" id="${inputId}" value="${sel||'bolt'}">`;
}
window.selectIcon=function(inputId,key){document.getElementById(inputId).value=key;document.getElementById(inputId).closest('.form-group').querySelectorAll('.icon-option').forEach(el=>el.classList.toggle('selected',el.dataset.icon===key))};

function renderAdminList(){
document.getElementById('admin-list').innerHTML=assistantsData.map(a=>`<div class="admin-item" data-id="${a.id}">
<div class="admin-item-header">
<div class="admin-item-title"><div class="admin-icon">${getIcon(a.icon||'bolt')}</div><h4>${a.name}</h4></div>
<div class="admin-item-actions"><button class="admin-edit-btn" onclick="toggleEdit('${a.id}')">${t('edit_btn')}</button><button class="admin-delete-btn" onclick="confirmDel('${a.id}')">${t('delete_btn')}</button></div>
</div>
<div id="ef-${a.id}" style="display:none;margin-top:16px">
<div class="form-group"><label>${t('name_label')}</label><input id="en-${a.id}" value="${esc(a.name)}"></div>
<div class="form-group"><label>${t('icon_label')}</label>${renderIconSelector(a.icon||'bolt','ei-'+a.id)}</div>
<div class="admin-item-row"><div class="form-group"><label>${t('tag_label')}</label><input id="et-${a.id}" value="${esc(a.tag||'')}"></div><div class="form-group"><label>${t('model_label')}</label><input id="em-${a.id}" value="${esc(a.model||'gpt-5.2')}"></div></div>
<div class="form-group"><label>${t('desc_label')}</label><input id="ed-${a.id}" value="${esc(a.description||'')}"></div>
<div class="form-group"><label>${t('welcome_label')}</label><input id="ew-${a.id}" value="${esc(a.welcome||'')}"></div>
<div class="form-group"><label>${t('prompt_label')}</label><textarea id="ep-${a.id}" rows="6">${esc(a.prompt||'')}</textarea></div>
<div class="form-group"><label>${t('order_label')}</label><input id="eo-${a.id}" type="number" value="${a.order||0}" style="width:100px"></div>
<button class="admin-save-btn" onclick="saveA('${a.id}')">${t('save_btn')}</button>
</div></div>`).join('');
}

function esc(s){if(!s)return '';return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'&#10;')}
window.toggleEdit=function(id){const f=document.getElementById('ef-'+id);f.style.display=f.style.display==='none'?'':'none'};
window.saveA=async function(id){
const d={name:document.getElementById('en-'+id).value,icon:document.getElementById('ei-'+id).value,tag:document.getElementById('et-'+id).value,model:document.getElementById('em-'+id).value,description:document.getElementById('ed-'+id).value,welcome:document.getElementById('ew-'+id).value,prompt:document.getElementById('ep-'+id).value,order:parseInt(document.getElementById('eo-'+id).value)||0};
try{await db.collection('assistants').doc(id).update(d);await loadAssistants();if(currentView==='admin')renderAdminList();showToast(t('saved'))}catch(e){alert(t('error'));console.error(e)}
};
document.getElementById('admin-add-btn').addEventListener('click',async()=>{
try{await db.collection('assistants').add({name:"Новий асистент",icon:"bolt",description:"Опис",tag:"AI",model:"gpt-5.2",prompt:"Ти — AI-асистент.",welcome:"Чим допомогти?",order:assistantsData.length});await loadAssistants();renderAdminList();showToast(t('saved'))}catch(e){alert(t('error'))}
});
let delId=null;
window.confirmDel=function(id){delId=id;document.getElementById('delete-modal').classList.add('active')};
document.getElementById('delete-cancel').addEventListener('click',()=>{document.getElementById('delete-modal').classList.remove('active');delId=null});
document.getElementById('delete-confirm').addEventListener('click',async()=>{
if(!delId)return;try{await db.collection('assistants').doc(delId).delete();document.getElementById('delete-modal').classList.remove('active');delId=null;await loadAssistants();renderAdminList()}catch(e){alert(t('error'))}
});
document.getElementById('delete-modal').addEventListener('click',e=>{if(e.target===e.currentTarget){document.getElementById('delete-modal').classList.remove('active');delId=null}});
</script>
</body>
</html>
