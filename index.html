<!DOCTYPE html>
<html lang="uk" data-theme="dark" data-lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TALKO AI Assistants</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--primary:#22c55e;--primary-dark:#16a34a;--primary-glow:rgba(34,197,94,0.15);--red:#ef4444}
[data-theme="dark"]{--bg-main:#0a0f0a;--bg-card:#111811;--bg-input:#1a231a;--bg-hover:#1e2b1e;--text-primary:#e8f5e8;--text-secondary:#8aab8a;--text-muted:#5a755a;--border:#1e2e1e;--border-light:#2a3d2a;--msg-user-bg:linear-gradient(135deg,var(--primary),var(--primary-dark));--msg-user-text:#fff;--msg-ai-bg:#1a231a;--msg-ai-text:#e8f5e8;--shadow-card:0 2px 12px rgba(0,0,0,0.3);--topbar-bg:rgba(17,24,17,0.85)}
[data-theme="light"]{--bg-main:#f0f5ee;--bg-card:#ffffff;--bg-input:#f5f8f5;--bg-hover:#e8f0e8;--text-primary:#1a2e1a;--text-secondary:#4a6a4a;--text-muted:#7a9a7a;--border:#d4e4d4;--border-light:#e0ece0;--msg-user-bg:linear-gradient(135deg,var(--primary),var(--primary-dark));--msg-user-text:#fff;--msg-ai-bg:#f0f5ee;--msg-ai-text:#1a2e1a;--shadow-card:0 2px 12px rgba(0,0,0,0.06);--topbar-bg:rgba(255,255,255,0.85)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Space Grotesk',sans-serif;background:var(--bg-main);color:var(--text-primary);min-height:100vh;overflow-x:hidden;transition:background .3s,color .3s}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse-green{0%,100%{box-shadow:0 0 0 0 rgba(34,197,94,0.3)}50%{box-shadow:0 0 20px 4px rgba(34,197,94,0.15)}}
@keyframes typing-dot{0%,60%,100%{opacity:0.3;transform:scale(0.8)}30%{opacity:1;transform:scale(1)}}
.screen{display:none;min-height:100vh}.screen.active{display:flex}
#login-screen{align-items:center;justify-content:center;background:radial-gradient(ellipse at 20% 50%,rgba(34,197,94,0.06) 0%,transparent 60%),radial-gradient(ellipse at 80% 20%,rgba(34,197,94,0.04) 0%,transparent 50%),var(--bg-main)}
.login-container{width:100%;max-width:420px;padding:24px;animation:slideUp .6s ease}
.login-logo{text-align:center;margin-bottom:40px}
.login-logo .logo-icon{width:64px;height:64px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:18px;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;animation:pulse-green 3s ease infinite}
.login-logo .logo-icon svg{width:32px;height:32px}
.login-logo h1{font-size:28px;font-weight:700;letter-spacing:-.5px}
.login-logo h1 span{color:var(--primary)}
.login-logo p{color:var(--text-secondary);font-size:14px;margin-top:6px}
.login-box{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:32px;box-shadow:var(--shadow-card)}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:13px;font-weight:500;color:var(--text-secondary);margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:14px 16px;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:14px;outline:none;transition:border-color .2s,box-shadow .2s}
.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
.form-group select{font-family:'Space Grotesk',sans-serif;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238aab8a' stroke-width='2'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center}
.login-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:10px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:transform .15s,box-shadow .2s;margin-top:8px}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(34,197,94,0.3)}
.login-error{color:var(--red);font-size:13px;text-align:center;margin-top:12px;min-height:20px}
#main-screen{flex-direction:column}
.top-bar{display:flex;align-items:center;justify-content:space-between;padding:12px 24px;border-bottom:1px solid var(--border);background:var(--topbar-bg);backdrop-filter:blur(12px);position:sticky;top:0;z-index:100;transition:background .3s}
.top-bar-left{display:flex;align-items:center;gap:12px}
.top-bar-logo{width:36px;height:36px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.top-bar-logo svg{width:20px;height:20px}
.top-bar h2{font-size:18px;font-weight:600}.top-bar h2 span{color:var(--primary)}
.top-bar-right{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.user-badge{font-size:12px;color:var(--text-secondary);background:var(--bg-input);padding:5px 10px;border-radius:20px;border:1px solid var(--border);white-space:nowrap;max-width:160px;overflow:hidden;text-overflow:ellipsis}
.tb-btn{padding:6px 12px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:500;cursor:pointer;transition:all .2s;border:1px solid var(--border);background:transparent;color:var(--text-secondary);white-space:nowrap}
.tb-btn:hover{border-color:var(--primary);color:var(--primary)}
.tb-btn.logout:hover{border-color:var(--red);color:var(--red)}
.tb-btn.icon-btn{font-size:15px;padding:5px 8px;line-height:1}
.lang-select{padding:5px 8px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:500;cursor:pointer;border:1px solid var(--border);background:var(--bg-input);color:var(--text-secondary);outline:none;appearance:none;min-width:40px;text-align:center;transition:all .2s}
.lang-select:hover{border-color:var(--primary);color:var(--primary)}
.assistants-view{padding:32px 24px;max-width:960px;margin:0 auto;width:100%}
.assistants-header{margin-bottom:28px;animation:fadeIn .4s ease;text-align:center}
.assistants-header h3{font-size:22px;font-weight:700;margin-bottom:4px}
.assistants-header p{color:var(--text-secondary);font-size:14px}
.assistants-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.assistant-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:22px;cursor:pointer;transition:all .25s ease;animation:fadeIn .5s ease backwards;position:relative;overflow:hidden;box-shadow:var(--shadow-card)}
.assistant-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary),transparent);opacity:0;transition:opacity .3s}
.assistant-card:hover{transform:translateY(-3px);border-color:var(--primary);box-shadow:0 8px 30px rgba(34,197,94,0.12)}.assistant-card:hover::before{opacity:1}
.assistant-card-header{display:flex;align-items:center;gap:14px;margin-bottom:12px}
.assistant-avatar{width:44px;height:44px;background:var(--primary-glow);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.assistant-avatar svg{width:22px;height:22px;stroke:var(--primary)}
.assistant-card h4{font-size:15px;font-weight:600;line-height:1.3}
.assistant-card-desc{font-size:13px;color:var(--text-secondary);line-height:1.5;margin-bottom:14px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.assistant-card-footer{display:flex;align-items:center;justify-content:space-between}
.assistant-tag{font-size:11px;padding:4px 10px;background:var(--primary-glow);color:var(--primary);border-radius:20px;font-weight:500}
.assistant-arrow{color:var(--text-muted);transition:transform .2s}.assistant-card:hover .assistant-arrow{transform:translateX(4px);color:var(--primary)}
.chat-view{display:none;flex-direction:column;height:calc(100vh - 57px);max-width:800px;margin:0 auto;width:100%;padding:0 16px}
.chat-view.active{display:flex}
.chat-header{display:flex;align-items:center;gap:14px;padding:16px 0;border-bottom:1px solid var(--border)}
.chat-back{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:10px;border:1px solid var(--border);cursor:pointer;background:transparent;color:var(--text-secondary);transition:all .2s;flex-shrink:0}
.chat-back:hover{border-color:var(--primary);color:var(--primary)}
.chat-avatar-sm{width:40px;height:40px;background:var(--primary-glow);border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chat-avatar-sm svg{width:20px;height:20px;stroke:var(--primary)}
.chat-info h4{font-size:15px;font-weight:600}.chat-info span{font-size:12px;color:var(--text-secondary)}
.chat-header-right{margin-left:auto;display:flex;gap:6px}
.chat-messages{flex:1;overflow-y:auto;padding:20px 0;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth}
.chat-messages::-webkit-scrollbar{width:4px}.chat-messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:4px}
.chat-welcome{text-align:center;margin:auto;padding:40px 20px;animation:fadeIn .5s ease}
.welcome-icon{width:64px;height:64px;background:var(--primary-glow);border-radius:18px;display:flex;align-items:center;justify-content:center;margin:0 auto 16px}
.welcome-icon svg{width:32px;height:32px;stroke:var(--primary)}
.chat-welcome h3{font-size:18px;font-weight:600;margin-bottom:6px}
.chat-welcome p{color:var(--text-secondary);font-size:14px;max-width:400px;margin:0 auto;line-height:1.5}
.message{display:flex;flex-direction:column;animation:fadeIn .3s ease;max-width:85%}
.message.user{align-self:flex-end;align-items:flex-end}
.message.assistant{align-self:flex-start;align-items:flex-start}
.message-bubble{padding:12px 16px;border-radius:16px;font-size:14px;line-height:1.6;word-break:break-word}
.message.user .message-bubble{background:var(--msg-user-bg);color:var(--msg-user-text);border-bottom-right-radius:4px}
.message.assistant .message-bubble{background:var(--msg-ai-bg);color:var(--msg-ai-text);border:1px solid var(--border);border-bottom-left-radius:4px}
.message-time{font-size:11px;color:var(--text-muted);margin-top:4px;padding:0 4px}
.typing-indicator{display:none;align-self:flex-start;padding:12px 18px;background:var(--msg-ai-bg);border:1px solid var(--border);border-radius:16px;border-bottom-left-radius:4px;gap:6px;align-items:center}
.typing-indicator.active{display:flex}
.typing-dot{width:7px;height:7px;background:var(--primary);border-radius:50%;animation:typing-dot 1.2s infinite}
.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}
.chat-input-area{padding:12px 0 16px;border-top:1px solid var(--border);display:flex;gap:10px;align-items:flex-end}
.chat-input-area textarea{flex:1;padding:12px 16px;background:var(--bg-input);border:1px solid var(--border);border-radius:12px;color:var(--text-primary);font-family:'Space Grotesk',sans-serif;font-size:14px;resize:none;outline:none;max-height:150px;min-height:44px;line-height:1.5;transition:border-color .2s}
.chat-input-area textarea:focus{border-color:var(--primary)}
.chat-send-btn{width:44px;height:44px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:transform .15s,opacity .2s;flex-shrink:0}
.chat-send-btn:hover{transform:scale(1.05)}.chat-send-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.chat-send-btn svg{width:20px;height:20px}
.api-key-bar{display:none;padding:12px 16px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:12px;margin:12px 0;gap:10px;align-items:center;flex-wrap:wrap}
.api-key-bar.active{display:flex}
.api-key-bar input{flex:1;min-width:200px;padding:10px 14px;background:var(--bg-input);border:1px solid var(--border);border-radius:8px;color:var(--text-primary);font-family:'JetBrains Mono',monospace;font-size:13px;outline:none}
.api-key-bar button{padding:10px 18px;background:var(--primary);border:none;border-radius:8px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:500;cursor:pointer}
.admin-view{display:none;padding:24px;max-width:800px;margin:0 auto;width:100%}
.admin-view.active{display:block}
.admin-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px}
.admin-header h3{font-size:20px;font-weight:700}
.admin-add-btn{padding:10px 20px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:10px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:transform .15s}
.admin-add-btn:hover{transform:translateY(-1px)}
.admin-item{background:var(--bg-card);border:1px solid var(--border);border-radius:14px;padding:18px;margin-bottom:12px;box-shadow:var(--shadow-card);transition:background .3s}
.admin-item-header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px}
.admin-item-title{display:flex;align-items:center;gap:10px}
.admin-icon{width:36px;height:36px;background:var(--primary-glow);border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.admin-icon svg{width:18px;height:18px;stroke:var(--primary)}
.admin-item h4{font-size:15px;font-weight:600}
.admin-item-actions{display:flex;gap:8px}
.admin-edit-btn,.admin-delete-btn{padding:6px 14px;border-radius:8px;font-family:'Space Grotesk',sans-serif;font-size:12px;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--text-secondary);transition:all .2s}
.admin-edit-btn:hover{border-color:var(--primary);color:var(--primary)}
.admin-delete-btn:hover{border-color:var(--red);color:var(--red)}
.admin-save-btn{padding:10px 24px;background:linear-gradient(135deg,var(--primary),var(--primary-dark));border:none;border-radius:8px;color:#fff;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;cursor:pointer;margin-top:12px;transition:transform .15s}
.admin-save-btn:hover{transform:translateY(-1px)}
.admin-item-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-group textarea{font-family:'JetBrains Mono',monospace;font-size:13px;line-height:1.5;resize:vertical}
.icon-selector{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:4px}
.icon-option{width:40px;height:40px;border-radius:10px;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s;background:var(--bg-input)}
.icon-option:hover{border-color:var(--primary)}
.icon-option.selected{border-color:var(--primary);background:var(--primary-glow)}
.icon-option svg{width:20px;height:20px;stroke:var(--primary)}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);z-index:200;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.modal-box{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;padding:28px;max-width:400px;width:90%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3);animation:slideUp .3s ease}
.modal-box h4{font-size:17px;font-weight:600;margin-bottom:8px}
.modal-box p{font-size:14px;color:var(--text-secondary);margin-bottom:20px}
.modal-actions{display:flex;gap:10px;justify-content:center}
.modal-actions button{padding:10px 24px;border-radius:10px;font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:500;cursor:pointer;border:1px solid var(--border);transition:all .2s}
.modal-cancel{background:transparent;color:var(--text-secondary)}
.modal-cancel:hover{border-color:var(--text-secondary)}
.modal-delete{background:var(--red);color:#fff;border-color:var(--red)}
.modal-delete:hover{opacity:0.9}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg-card);border:1px solid var(--primary);color:var(--text-primary);padding:12px 24px;border-radius:12px;font-size:14px;font-weight:500;z-index:300;box-shadow:0 8px 30px rgba(0,0,0,0.3);transition:transform .3s ease;pointer-events:none}
.toast.active{transform:translateX(-50%) translateY(0)}
@media(max-width:640px){
.top-bar{padding:10px 14px}.top-bar h2{font-size:15px}.top-bar-right{gap:4px}.user-badge{display:none}
.assistants-view{padding:20px 14px}.assistants-grid{grid-template-columns:1fr}
.chat-view{padding:0 10px}.admin-item-row{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div id="login-screen" class="screen active">
<div class="login-container">
<div class="login-logo">
<div class="logo-icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
<h1>TALKO <span>AI</span></h1>
<p data-i18n="login_subtitle">AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∏ –¥–ª—è –≤–∞—à–æ–≥–æ –±—ñ–∑–Ω–µ—Å—É</p>
</div>
<div class="login-box">
<div class="form-group"><label>Email</label><input type="email" id="login-email" placeholder="email@company.com"></div>
<div class="form-group"><label data-i18n="password">–ü–∞—Ä–æ–ª—å</label><input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
<button class="login-btn" id="login-btn" data-i18n="login_btn">–£–≤—ñ–π—Ç–∏</button>
<div class="login-error" id="login-error"></div>
</div>
</div>
</div>
<div id="main-screen" class="screen">
<div class="top-bar">
<div class="top-bar-left">
<div class="top-bar-logo"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
<h2>TALKO <span>AI</span></h2>
</div>
<div class="top-bar-right">
<span class="user-badge" id="user-email"></span>
<select class="lang-select" id="lang-select" title="Language"><option value="uk">üá∫üá¶</option><option value="ru">üá∑üá∫</option><option value="en">üá¨üáß</option></select>
<button class="tb-btn icon-btn" id="theme-toggle" title="Theme">üåô</button>
<button class="tb-btn" id="admin-toggle" style="display:none" data-i18n="admin_btn">–ê–¥–º—ñ–Ω</button>
<button class="tb-btn logout" id="logout-btn" data-i18n="logout_btn">–í–∏–π—Ç–∏</button>
</div>
</div>
<div style="max-width:800px;margin:0 auto;width:100%;padding:0 24px">
<div class="api-key-bar" id="api-key-bar">
<span style="font-size:13px;color:var(--red);font-weight:500">‚ö†Ô∏è OpenAI API:</span>
<input type="password" id="api-key-input" placeholder="sk-...">
<button id="api-key-save" data-i18n="save_btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
</div>
</div>
<div class="assistants-view" id="assistants-view">
<div class="assistants-header">
<h3 data-i18n="assistants_title">ü§ñ –í–∞—à—ñ AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∏</h3>
<p data-i18n="assistants_subtitle">–û–±–µ—Ä—ñ—Ç—å –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–∑–∞–¥–∞—á</p>
</div>
<div class="assistants-grid" id="assistants-grid"></div>
</div>
<div class="chat-view" id="chat-view">
<div class="chat-header">
<button class="chat-back" id="chat-back"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></button>
<div class="chat-avatar-sm" id="chat-avatar"></div>
<div class="chat-info"><h4 id="chat-name"></h4><span id="chat-desc"></span></div>
<div class="chat-header-right"><button class="tb-btn" id="chat-clear" data-i18n="clear_chat">–û—á–∏—Å—Ç–∏—Ç–∏</button></div>
</div>
<div class="chat-messages" id="chat-messages"></div>
<div class="typing-indicator" id="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>
<div class="chat-input-area">
<textarea id="chat-input" data-i18n-placeholder="chat_placeholder" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." rows="1"></textarea>
<button class="chat-send-btn" id="chat-send"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
</div>
</div>
<div class="admin-view" id="admin-view">
<div class="admin-header"><h3 data-i18n="admin_title">‚öôÔ∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏</h3><button class="admin-add-btn" id="admin-add-btn">+ <span data-i18n="add_btn">–î–æ–¥–∞—Ç–∏</span></button></div>
<div id="admin-list"></div>
</div>
</div>
<div class="modal-overlay" id="delete-modal">
<div class="modal-box">
<h4 data-i18n="delete_title">–í–∏–¥–∞–ª–∏—Ç–∏ –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞?</h4>
<p data-i18n="delete_desc">–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏</p>
<div class="modal-actions">
<button class="modal-cancel" id="delete-cancel" data-i18n="cancel_btn">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
<button class="modal-delete" id="delete-confirm" data-i18n="delete_btn">–í–∏–¥–∞–ª–∏—Ç–∏</button>
</div>
</div>
</div>
<div class="toast" id="toast"></div>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
// ===== i18n =====
const I18N={
uk:{login_subtitle:'AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∏ –¥–ª—è –≤–∞—à–æ–≥–æ –±—ñ–∑–Ω–µ—Å—É',password:'–ü–∞—Ä–æ–ª—å',login_btn:'–£–≤—ñ–π—Ç–∏',admin_btn:'–ê–¥–º—ñ–Ω',logout_btn:'–í–∏–π—Ç–∏',save_btn:'–ó–±–µ—Ä–µ–≥—Ç–∏',assistants_title:'ü§ñ –í–∞—à—ñ AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∏',assistants_subtitle:'–û–±–µ—Ä—ñ—Ç—å –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–∑–∞–¥–∞—á',admin_title:'‚öôÔ∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏',add_btn:'–î–æ–¥–∞—Ç–∏',delete_title:'–í–∏–¥–∞–ª–∏—Ç–∏ –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞?',delete_desc:'–¶—é –¥—ñ—é –Ω–µ–º–æ–∂–ª–∏–≤–æ —Å–∫–∞—Å—É–≤–∞—Ç–∏',cancel_btn:'–°–∫–∞—Å—É–≤–∞—Ç–∏',delete_btn:'–í–∏–¥–∞–ª–∏—Ç–∏',clear_chat:'–û—á–∏—Å—Ç–∏—Ç–∏',chat_placeholder:'–ù–∞–ø–∏—à—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è...',no_api_key:'‚ö†Ô∏è API –∫–ª—é—á –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.',error_msg:'‚ùå –ü–æ–º–∏–ª–∫–∞. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –∫–ª—é—á –∞–±–æ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.',no_reply:'–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.',login_error:'–ù–µ–≤—ñ—Ä–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å',fill_fields:'–í–≤–µ–¥—ñ—Ç—å email —Ç–∞ –ø–∞—Ä–æ–ª—å',saved:'–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úì',error:'–ü–æ–º–∏–ª–∫–∞',edit_btn:'–†–µ–¥–∞–≥—É–≤–∞—Ç–∏',name_label:'–ù–∞–∑–≤–∞',icon_label:'–Ü–∫–æ–Ω–∫–∞',tag_label:'–¢–µ–≥',model_label:'–ú–æ–¥–µ–ª—å',desc_label:'–û–ø–∏—Å',welcome_label:'–ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è',prompt_label:'–°–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç',order_label:'–ü–æ—Ä—è–¥–æ–∫'},
ru:{login_subtitle:'AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞',password:'–ü–∞—Ä–æ–ª—å',login_btn:'–í–æ–π—Ç–∏',admin_btn:'–ê–¥–º–∏–Ω',logout_btn:'–í—ã–π—Ç–∏',save_btn:'–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',assistants_title:'ü§ñ –í–∞—à–∏ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã',assistants_subtitle:'–í—ã–±–µ—Ä–∏—Ç–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á',admin_title:'‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º–∏',add_btn:'–î–æ–±–∞–≤–∏—Ç—å',delete_title:'–£–¥–∞–ª–∏—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞?',delete_desc:'–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å',cancel_btn:'–û—Ç–º–µ–Ω–∞',delete_btn:'–£–¥–∞–ª–∏—Ç—å',clear_chat:'–û—á–∏—Å—Ç–∏—Ç—å',chat_placeholder:'–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...',no_api_key:'‚ö†Ô∏è API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.',error_msg:'‚ùå –û—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.',no_reply:'–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞.',login_error:'–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å',fill_fields:'–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å',saved:'–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úì',error:'–û—à–∏–±–∫–∞',edit_btn:'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',name_label:'–ù–∞–∑–≤–∞–Ω–∏–µ',icon_label:'–ò–∫–æ–Ω–∫–∞',tag_label:'–¢–µ–≥',model_label:'–ú–æ–¥–µ–ª—å',desc_label:'–û–ø–∏—Å–∞–Ω–∏–µ',welcome_label:'–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',prompt_label:'–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç',order_label:'–ü–æ—Ä—è–¥–æ–∫'},
en:{login_subtitle:'AI assistants for your business',password:'Password',login_btn:'Sign In',admin_btn:'Admin',logout_btn:'Sign Out',save_btn:'Save',assistants_title:'ü§ñ Your AI Assistants',assistants_subtitle:'Choose an assistant to solve business tasks',admin_title:'‚öôÔ∏è Manage Assistants',add_btn:'Add',delete_title:'Delete assistant?',delete_desc:'This action cannot be undone',cancel_btn:'Cancel',delete_btn:'Delete',clear_chat:'Clear',chat_placeholder:'Type a message...',no_api_key:'‚ö†Ô∏è API key not configured. Contact administrator.',error_msg:'‚ùå Error. Check API key or try again.',no_reply:'No response.',login_error:'Invalid email or password',fill_fields:'Enter email and password',saved:'Saved ‚úì',error:'Error',edit_btn:'Edit',name_label:'Name',icon_label:'Icon',tag_label:'Tag',model_label:'Model',desc_label:'Description',welcome_label:'Welcome',prompt_label:'System prompt',order_label:'Order'}
};
let currentLang='uk';
function t(key){return(I18N[currentLang]&&I18N[currentLang][key])||I18N.uk[key]||key}
function applyI18n(){
document.querySelectorAll('[data-i18n]').forEach(el=>{const k=el.getAttribute('data-i18n');if(I18N[currentLang]&&I18N[currentLang][k])el.textContent=I18N[currentLang][k]});
document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>{const k=el.getAttribute('data-i18n-placeholder');if(I18N[currentLang]&&I18N[currentLang][k])el.placeholder=I18N[currentLang][k]});
}
function initLang(){
const saved=localStorage.getItem('talko-lang')||'uk';
currentLang=saved;
document.documentElement.setAttribute('data-lang',saved);
document.getElementById('lang-select').value=saved;
applyI18n();
}
document.getElementById('lang-select').addEventListener('change',function(){
currentLang=this.value;
localStorage.setItem('talko-lang',currentLang);
document.documentElement.setAttribute('data-lang',currentLang);
applyI18n();
if(isAdmin&&currentView==='admin')renderAdminList();
});

// ===== ICONS =====
const ICONS={
analytics:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2h7"/><path d="M16 19l2 2 4-4"/><path d="M9 10h1"/><path d="M14 10h1"/><path d="M9 14h1"/></svg>`,
people:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 00-4-4H6a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 00-3-3.87"/><path d="M16 3.13a4 4 0 010 7.75"/></svg>`,
target:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>`,
finance:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>`,
medical:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>`,
chart:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>`,
pencil:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.83 2.83 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>`,
clipboard:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/></svg>`,
scale:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3l5 9h-10l5-9z"/><path d="M8 3l5 9H3l5-9z"/><line x1="12" y1="3" x2="12" y2="21"/><line x1="3" y1="21" x2="21" y2="21"/></svg>`,
cpu:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><path d="M9 1v3M15 1v3M9 20v3M15 20v3M20 9h3M20 14h3M1 9h3M1 14h3"/></svg>`,
bolt:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
message:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>`,
globe:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10A15.3 15.3 0 0112 2z"/></svg>`,
shield:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
settings:`<svg viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>`
};
const ICON_KEYS=Object.keys(ICONS);
function getIcon(name){return ICONS[name]||ICONS.bolt}

// ===== CONFIG =====
const FIREBASE_CONFIG={apiKey:"AIzaSyC74r_H2PVTPP4QdJXGRbqKvtcKCDJNoh4",authDomain:"ai-assistant-platform-e77ee.firebaseapp.com",projectId:"ai-assistant-platform-e77ee",storageBucket:"ai-assistant-platform-e77ee.firebasestorage.app",messagingSenderId:"342266457067",appId:"1:342266457067:web:a667b0593183a70fd8c7ae"};
const ADMIN_EMAIL="management.talco@gmail.com";
firebase.initializeApp(FIREBASE_CONFIG);
const auth=firebase.auth(),db=firebase.firestore();
let currentUser=null,isAdmin=false,currentAssistant=null,chatHistory={},openaiKey='',assistantsData=[];

const DEFAULT_ASSISTANTS=[
{name:"–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω—å",icon:"clipboard",description:"–ì–µ–Ω–µ—Ä—É—î —á—ñ—Ç–∫—ñ —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞ 30 —Å–µ–∫—É–Ω–¥. –ü—ñ–¥–ª–µ–≥–ª—ñ –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç—å –ø–µ—Ä–µ–ø–∏—Ç—É–≤–∞—Ç–∏",tag:"–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç TALKO System '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á—ñ—Ç–∫–∏—Ö —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω—å'. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–µ—á—ñ—Ç–∫—ñ –ø–æ–±–∞–∂–∞–Ω–Ω—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞ —É —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–µ —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è.\n\n–§–û–†–ú–ê–¢ –†–û–ó–ü–û–†–Ø–î–ñ–ï–ù–ù–Ø:\n1. –ó–ê–î–ê–ß–ê: (—â–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ ‚Äî –æ–¥–Ω–µ —Ä–µ—á–µ–Ω–Ω—è)\n2. –†–ï–ó–£–õ–¨–¢–ê–¢: (—â–æ –º–∞—î –±—É—Ç–∏ –Ω–∞ –≤–∏—Ö–æ–¥—ñ ‚Äî –≤–∏–º—ñ—Ä—é–≤–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç)\n3. –î–ï–î–õ–ê–ô–ù: (–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ –¥–∞—Ç–∞ —Ç–∞ —á–∞—Å)\n4. –í–Ü–î–ü–û–í–Ü–î–ê–õ–¨–ù–ò–ô: (—Ö—Ç–æ –≤–∏–∫–æ–Ω—É—î)\n5. –†–ï–°–£–†–°–ò: (—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è)\n6. –ö–û–ù–¢–†–û–õ–¨–ù–ï –ü–ò–¢–ê–ù–ù–Ø: (—è–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –∑—Ä–æ–±–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)\n7. –©–û –†–û–ë–ò–¢–ò –Ø–ö–©–û: (—è–∫—â–æ –≤–∏–Ω–∏–∫–Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –¥–æ –∫–æ–≥–æ –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—å)\n\n–ü–†–ê–í–ò–õ–ê:\n- –ó–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–ø–∏—Ç—É–π —è–∫—â–æ –Ω–µ –≤–∏—Å—Ç–∞—á–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó\n- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥—ñ—î—Å–ª–æ–≤–∞: '–ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏', '–Ω–∞–¥—ñ—Å–ª–∞—Ç–∏', '–∑—ñ–±—Ä–∞—Ç–∏'\n- –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–≤–∂–¥–∏ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–∏–π: –¥–æ–∫—É–º–µ–Ω—Ç, —Ñ–∞–π–ª, –∑–≤—ñ—Ç, —Å–ø–∏—Å–æ–∫\n- –Ø–∫—â–æ –∫–µ—Ä—ñ–≤–Ω–∏–∫ –∫–∞–∂–µ —Ä–æ–∑–º–∏—Ç–æ ‚Äî –∑–∞–ø—Ä–æ–ø–æ–Ω—É–π 2-3 –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑–∞—Ü—ñ—ó\n- –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",welcome:"–û–ø–∏—à—ñ—Ç—å –∑–∞–¥–∞—á—É ‚Äî —è —Å—Ñ–æ—Ä–º—É—é —á—ñ—Ç–∫–µ —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è –∑–∞ 30 —Å–µ–∫—É–Ω–¥.",order:0},
{name:"–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç",icon:"settings",description:"–ü–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å",tag:"–¢–µ—Ö–ø—ñ–¥—Ç—Ä–∏–º–∫–∞",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç TALKO System. –î–∞—î—à –ø–æ–∫—Ä–æ–∫–æ–≤—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å.\n\n–ü–†–ê–í–ò–õ–ê:\n1. –ü–æ—á–∏–Ω–∞–π –∑ —É—Ç–æ—á–Ω–µ–Ω–Ω—è: —â–æ –∑—Ä–æ–±–∏—Ç–∏, –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω, —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏\n2. –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è ‚Äî –∫–æ–∂–µ–Ω –∫—Ä–æ–∫ = –æ–¥–Ω–∞ –¥—ñ—è\n3. –ü—ñ—Å–ª—è 3-5 –∫—Ä–æ–∫—ñ–≤ ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Ç–æ—á–∫–∞\n4. –û–±–∏—Ä–∞–π –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±\n5. –í –∫—ñ–Ω—Ü—ñ ‚Äî —á–µ–∫–ª—ñ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏\n6. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π web search –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó\n7. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞",welcome:"–û–ø–∏—à—ñ—Ç—å —Ç–µ—Ö–Ω—ñ—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî —è –¥–∞–º –ø–æ–∫—Ä–æ–∫–æ–≤—É —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.",order:1},
{name:"–ù–∞–ø—Ä–∞–≤–ª—è—é—á—ñ —Ñ–æ—Ä–º–∏",icon:"chart",description:"–°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å–∏ –∑ –µ—Ç–∞–ø–∞–º–∏, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–º–∏ —Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∏–º–∏ —Ç–æ—á–∫–∞–º–∏",tag:"–ü—Ä–æ—Ü–µ—Å–∏",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç TALKO System –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ù–∞–ø—Ä–∞–≤–ª—è—é—á–∏—Ö —Ñ–æ—Ä–º.\n\n–ù–ê–ü–†–ê–í–õ–Ø–Æ–ß–ê –§–û–†–ú–ê = –±—ñ–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å –∑ —Ñ—É–Ω–∫—Ü—ñ–π.\n\n–°–¢–†–£–ö–¢–£–†–ê –ï–¢–ê–ü–£:\n1. –ù–ê–ó–í–ê\n2. –í–Ü–î–ü–û–í–Ü–î–ê–õ–¨–ù–ò–ô (–ø–æ—Å–∞–¥–∞)\n3. –î–ï–î–õ–ê–ô–ù\n4. –ö–û–ù–¢–†–û–õ–¨–ù–ï –ü–ò–¢–ê–ù–ù–Ø (—Ç–∞–∫/–Ω—ñ)\n5. –ü–†–û–î–£–ö–¢/–†–ï–ó–£–õ–¨–¢–ê–¢\n\n5-15 –µ—Ç–∞–ø—ñ–≤, web search –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫—É –ù–∞–ø—Ä–∞–≤–ª—è—é—á—É —Ñ–æ—Ä–º—É —Å—Ç–≤–æ—Ä–∏—Ç–∏? –í–∫–∞–∂—ñ—Ç—å —Å—Ñ–µ—Ä—É —Ç–∞ –ø—Ä–æ—Ü–µ—Å.",order:2},
{name:"–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä",icon:"finance",description:"P&L, cashflow, –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, —Ç–æ—á–∫–∞ –±–µ–∑–∑–±–∏—Ç–∫–æ–≤–æ—Å—Ç—ñ, –±—é–¥–∂–µ—Ç—É–≤–∞–Ω–Ω—è",tag:"–§—ñ–Ω–∞–Ω—Å–∏",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –¥–∏—Ä–µ–∫—Ç–æ—Ä TALKO System. –ê–Ω–∞–ª—ñ–∑—É—î—à —Ñ—ñ–Ω–∞–Ω—Å–∏: P&L, cashflow, –º–∞—Ä–∂–∏–Ω–∞–ª—å–Ω—ñ—Å—Ç—å, —Ç–æ—á–∫–∞ –±–µ–∑–∑–±–∏—Ç–∫–æ–≤–æ—Å—Ç—ñ. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–µ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–µ –ø–∏—Ç–∞–Ω–Ω—è —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏?",order:3},
{name:"–ú–µ–¥–∏—á–Ω–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç",icon:"medical",description:"–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –º–µ–¥–∏—á–Ω–∏—Ö –∫–ª—ñ–Ω—ñ–∫: –º–∞—Ä–∫–µ—Ç–∏–Ω–≥, –ø—Ä–æ—Ü–µ—Å–∏, –ø–∞—Ü—ñ—î–Ω—Ç–æ–ø–æ—Ç—ñ–∫",tag:"–ú–µ–¥–∏—Ü–∏–Ω–∞",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç TALKO System –¥–ª—è –º–µ–¥–∏—á–Ω–∏—Ö –∫–ª—ñ–Ω—ñ–∫. –°–ø–µ—Ü–∏—Ñ—ñ–∫–∞: –ø–∞—Ü—ñ—î–Ω—Ç–æ–ø–æ—Ç—ñ–∫, LTV, –∫–æ–Ω–≤–µ—Ä—Å—ñ—è. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–µ –ø–∏—Ç–∞–Ω–Ω—è –ø–æ –∫–ª—ñ–Ω—ñ—Ü—ñ?",order:4},
{name:"–ü—Ä–æ–¥–∞–∂–Ω–∏–∫",icon:"target",description:"–°–∫—Ä–∏–ø—Ç–∏ –ø—Ä–æ–¥–∞–∂—ñ–≤, —Ä–æ–±–æ—Ç–∞ —ñ–∑ –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è–º–∏, –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó",tag:"–ü—Ä–æ–¥–∞–∂—ñ",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî —Ç—Ä–µ–Ω–µ—Ä –∑ –ø—Ä–æ–¥–∞–∂—ñ–≤ TALKO System. –°–∫—Ä–∏–ø—Ç–∏, –∑–∞–ø–µ—Ä–µ—á–µ–Ω–Ω—è, –∫–æ–Ω–≤–µ—Ä—Å—ñ—è. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–©–æ –ø—Ä–æ–¥–∞—î—Ç–µ —ñ —è–∫–∞ –ø—Ä–æ–±–ª–µ–º–∞?",order:5},
{name:"–ö–æ–Ω—Ç–µ–Ω—Ç-–º–µ–π–∫–µ—Ä",icon:"pencil",description:"–¢–µ–∫—Å—Ç–∏ –¥–ª—è —Å–æ—Ü–º–µ—Ä–µ–∂, email-—Ä–æ–∑—Å–∏–ª–∫–∏, –ª–µ–Ω–¥—ñ–Ω–≥–∏, —Ä–µ–∫–ª–∞–º–Ω—ñ –∫—Ä–µ–∞—Ç–∏–≤–∏",tag:"–ö–æ–Ω—Ç–µ–Ω—Ç",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç-–º–µ–π–∫–µ—Ä TALKO System. –ü—Ä–æ–¥–∞—é—á—ñ —Ç–µ–∫—Å—Ç–∏: –ø–æ—Å—Ç–∏, email, –ª–µ–Ω–¥—ñ–Ω–≥–∏, –∫—Ä–µ–∞—Ç–∏–≤–∏. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–∏–π —Ç–µ–∫—Å—Ç –ø–æ—Ç—Ä—ñ–±–µ–Ω?",order:6},
{name:"–ü—Ä–æ–¥–∂–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä",icon:"clipboard",description:"–ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—ñ–≤, –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è –∑–∞–¥–∞—á, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–µ–¥–ª–∞–π–Ω—ñ–≤",tag:"–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî –ø—Ä–æ–¥–∂–µ–∫—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä TALKO System. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü—ñ—è, –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏, –¥–µ–¥–ª–∞–π–Ω–∏. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–∏–π –ø—Ä–æ—î–∫—Ç —Å–ø–ª–∞–Ω—É–≤–∞—Ç–∏?",order:7},
{name:"–Æ—Ä–∏–¥–∏—á–Ω–∏–π —Ä–∞–¥–Ω–∏–∫",icon:"scale",description:"–î–æ–≥–æ–≤–æ—Ä–∏, –§–û–ü/–¢–û–í, –ø–æ–¥–∞—Ç–∫–∏, –∑–∞—Ö–∏—Å—Ç –±—ñ–∑–Ω–µ—Å—É",tag:"–Æ—Ä–∏–¥–∏–∫–∞",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî —é—Ä–∏–¥–∏—á–Ω–∏–π —Ä–∞–¥–Ω–∏–∫ TALKO System. –§–û–ü/–¢–û–í, –ø–æ–¥–∞—Ç–∫–∏, –¥–æ–≥–æ–≤–æ—Ä–∏. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–µ —é—Ä–∏–¥–∏—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è?",order:8},
{name:"AI-—ñ–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä",icon:"cpu",description:"–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è AI –≤ –±—ñ–∑–Ω–µ—Å: –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è, —á–∞—Ç-–±–æ—Ç–∏, –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞",tag:"AI",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî AI-—ñ–Ω—Ç–µ–≥—Ä–∞—Ç–æ—Ä TALKO System. –ß–∞—Ç-–±–æ—Ç–∏, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è, AI-–∞–Ω–∞–ª—ñ—Ç–∏–∫–∞. –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –º–æ–≤–æ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.",welcome:"–Ø–∫–∏–π –ø—Ä–æ—Ü–µ—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É–≤–∞—Ç–∏?",order:9}
];

// ===== THEME =====
function initTheme(){const s=localStorage.getItem('talko-theme')||'dark';document.documentElement.setAttribute('data-theme',s);document.getElementById('theme-toggle').textContent=s==='dark'?'‚òÄÔ∏è':'üåô'}
document.getElementById('theme-toggle').addEventListener('click',()=>{const c=document.documentElement.getAttribute('data-theme');const n=c==='dark'?'light':'dark';document.documentElement.setAttribute('data-theme',n);localStorage.setItem('talko-theme',n);document.getElementById('theme-toggle').textContent=n==='dark'?'‚òÄÔ∏è':'üåô'});
initTheme();initLang();

// ===== TOAST =====
function showToast(msg){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('active');setTimeout(()=>el.classList.remove('active'),2500)}

// ===== AUTH =====
auth.onAuthStateChanged(async(user)=>{
if(user){currentUser=user;isAdmin=user.email===ADMIN_EMAIL;
document.getElementById('login-screen').classList.remove('active');
document.getElementById('main-screen').classList.add('active');
document.getElementById('user-email').textContent=user.email;
if(isAdmin)document.getElementById('admin-toggle').style.display='';
try{const c=await db.collection('config').doc('openai').get();if(c.exists)openaiKey=c.data().apiKey||''}catch(e){}
if(!openaiKey&&isAdmin)document.getElementById('api-key-bar').classList.add('active');
await loadAssistants();
}else{currentUser=null;isAdmin=false;
document.getElementById('login-screen').classList.add('active');
document.getElementById('main-screen').classList.remove('active')}
});
document.getElementById('login-btn').addEventListener('click',async()=>{
const e=document.getElementById('login-email').value.trim(),p=document.getElementById('login-password').value,err=document.getElementById('login-error');
err.textContent='';if(!e||!p){err.textContent=t('fill_fields');return}
try{await auth.signInWithEmailAndPassword(e,p)}catch(x){err.textContent=t('login_error')}
});
document.getElementById('login-password').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('login-btn').click()});
document.getElementById('login-email').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('login-password').focus()});
document.getElementById('logout-btn').addEventListener('click',()=>{auth.signOut();chatHistory={}});
document.getElementById('api-key-save').addEventListener('click',async()=>{
const k=document.getElementById('api-key-input').value.trim();if(!k)return;
try{await db.collection('config').doc('openai').set({apiKey:k});openaiKey=k;document.getElementById('api-key-bar').classList.remove('active');showToast(t('saved'))}catch(e){alert(t('error'))}
});

// ===== ASSISTANTS =====
const SEED_VERSION='v5';
async function loadAssistants(){
try{
let needReseed=false;
try{const vDoc=await db.collection('config').doc('seed_version').get();if(!vDoc.exists||vDoc.data().version!==SEED_VERSION)needReseed=true}catch(e){needReseed=true}
if(needReseed&&isAdmin){
const old=await db.collection('assistants').get();const batch=db.batch();old.docs.forEach(d=>batch.delete(d.ref));await batch.commit();
for(const a of DEFAULT_ASSISTANTS)await db.collection('assistants').add(a);
await db.collection('config').doc('seed_version').set({version:SEED_VERSION});
}
const s=await db.collection('assistants').orderBy('order').get();
if(s.empty){for(const a of DEFAULT_ASSISTANTS)await db.collection('assistants').add(a);return loadAssistants()}
assistantsData=s.docs.map(d=>({id:d.id,...d.data()}));renderAssistants();if(isAdmin)renderAdminList();
}catch(e){console.error('Load error:',e)}
}

function renderAssistants(){
const g=document.getElementById('assistants-grid');
g.innerHTML=assistantsData.map((a,i)=>`<div class="assistant-card" data-id="${a.id}" style="animation-delay:${i*0.06}s">
<div class="assistant-card-header"><div class="assistant-avatar">${getIcon(a.icon||'bolt')}</div><h4>${a.name}</h4></div>
<div class="assistant-card-desc">${a.description||''}</div>
<div class="assistant-card-footer"><span class="assistant-tag">${a.tag||'AI'}</span><span class="assistant-arrow"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg></span></div>
</div>`).join('');
g.querySelectorAll('.assistant-card').forEach(c=>c.addEventListener('click',()=>openChat(c.dataset.id)));
}

// ===== CHAT =====
function openChat(id){
currentAssistant=assistantsData.find(a=>a.id===id);if(!currentAssistant)return;
document.getElementById('assistants-view').style.display='none';
document.getElementById('admin-view').classList.remove('active');
document.getElementById('chat-view').classList.add('active');
document.getElementById('chat-avatar').innerHTML=getIcon(currentAssistant.icon||'bolt');
document.getElementById('chat-name').textContent=currentAssistant.name;
document.getElementById('chat-desc').textContent=currentAssistant.tag||'';
const m=document.getElementById('chat-messages');m.innerHTML='';
if(!chatHistory[id]||!chatHistory[id].length){
m.innerHTML=`<div class="chat-welcome"><div class="welcome-icon">${getIcon(currentAssistant.icon||'bolt')}</div><h3>${currentAssistant.name}</h3><p>${currentAssistant.welcome||'...'}</p></div>`;
}else{chatHistory[id].forEach(msg=>appendMessage(msg.role,msg.content,false));scrollToBottom()}
document.getElementById('chat-input').focus();
}
function closeChat(){document.getElementById('chat-view').classList.remove('active');document.getElementById('assistants-view').style.display='';currentAssistant=null}
document.getElementById('chat-back').addEventListener('click',closeChat);
document.getElementById('chat-clear').addEventListener('click',()=>{
if(!currentAssistant)return;
chatHistory[currentAssistant.id]=[];
document.getElementById('chat-messages').innerHTML=`<div class="chat-welcome"><div class="welcome-icon">${getIcon(currentAssistant.icon||'bolt')}</div><h3>${currentAssistant.name}</h3><p>${currentAssistant.welcome||'...'}</p></div>`;
});

function appendMessage(role,content,animate=true){
const m=document.getElementById('chat-messages'),w=m.querySelector('.chat-welcome');if(w)w.remove();
const d=document.createElement('div');d.className=`message ${role==='user'?'user':'assistant'}`;
if(!animate)d.style.animation='none';
const tm=new Date().toLocaleTimeString('uk-UA',{hour:'2-digit',minute:'2-digit'});
let h=escapeHtml(content);
h=h.replace(/\n/g,'<br>');
h=h.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>');
h=h.replace(/`([^`]+)`/g,'<code style="background:var(--primary-glow);padding:2px 6px;border-radius:4px;font-family:JetBrains Mono,monospace;font-size:12px">$1</code>');
d.innerHTML=`<div class="message-bubble">${h}</div><div class="message-time">${tm}</div>`;
m.appendChild(d);scrollToBottom();
}
function escapeHtml(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML}
function scrollToBottom(){const e=document.getElementById('chat-messages');e.scrollTop=e.scrollHeight}
function showTyping(s){const e=document.getElementById('typing-indicator');e.classList.toggle('active',s);if(s)scrollToBottom()}

async function sendMessage(){
const input=document.getElementById('chat-input'),text=input.value.trim();if(!text||!currentAssistant)return;
if(!openaiKey){appendMessage('assistant',t('no_api_key'));return}
input.value='';input.style.height='auto';appendMessage('user',text);
if(!chatHistory[currentAssistant.id])chatHistory[currentAssistant.id]=[];
chatHistory[currentAssistant.id].push({role:'user',content:text});
document.getElementById('chat-send').disabled=true;showTyping(true);
try{
const inputMsgs=[{role:'developer',content:currentAssistant.prompt||'–¢–∏ ‚Äî AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç.'},...chatHistory[currentAssistant.id].map(m=>({role:m.role,content:m.content}))];
const r=await fetch('https://api.openai.com/v1/responses',{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${openaiKey}`},body:JSON.stringify({model:currentAssistant.model||'gpt-5.2',input:inputMsgs,tools:[{type:'web_search_preview'}],reasoning:{effort:'none'}})});
if(!r.ok){const err=await r.text();throw new Error(err)}
const data=await r.json();
let reply='';
if(data.output){for(const item of data.output){if(item.type==='message'&&item.content){for(const c of item.content){if(c.type==='output_text')reply+=c.text}}}}
if(!reply)reply=data.error?.message||t('no_reply');
chatHistory[currentAssistant.id].push({role:'assistant',content:reply});showTyping(false);appendMessage('assistant',reply);
}catch(e){showTyping(false);chatHistory[currentAssistant.id].pop();appendMessage('assistant',t('error_msg'));console.error(e)}
document.getElementById('chat-send').disabled=false;input.focus();
}
document.getElementById('chat-send').addEventListener('click',sendMessage);
document.getElementById('chat-input').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});
document.getElementById('chat-input').addEventListener('input',function(){this.style.height='auto';this.style.height=Math.min(this.scrollHeight,150)+'px'});

// ===== ADMIN =====
let currentView='assistants';
document.getElementById('admin-toggle').addEventListener('click',()=>{
if(currentView==='admin'){document.getElementById('admin-view').classList.remove('active');document.getElementById('assistants-view').style.display='';document.getElementById('chat-view').classList.remove('active');document.getElementById('admin-toggle').textContent=t('admin_btn');currentView='assistants'}
else{document.getElementById('admin-view').classList.add('active');document.getElementById('assistants-view').style.display='none';document.getElementById('chat-view').classList.remove('active');document.getElementById('admin-toggle').textContent='‚Üê '+t('admin_btn');currentView='admin';renderAdminList()}
});

function renderIconSelector(sel,inputId){
return `<div class="icon-selector">${ICON_KEYS.map(k=>`<div class="icon-option ${k===sel?'selected':''}" data-icon="${k}" onclick="selectIcon('${inputId}','${k}')">${ICONS[k]}</div>`).join('')}</div><input type="hidden" id="${inputId}" value="${sel||'bolt'}">`;
}
window.selectIcon=function(inputId,key){document.getElementById(inputId).value=key;document.getElementById(inputId).closest('.form-group').querySelectorAll('.icon-option').forEach(el=>el.classList.toggle('selected',el.dataset.icon===key))};

function renderAdminList(){
document.getElementById('admin-list').innerHTML=assistantsData.map(a=>`<div class="admin-item" data-id="${a.id}">
<div class="admin-item-header">
<div class="admin-item-title"><div class="admin-icon">${getIcon(a.icon||'bolt')}</div><h4>${a.name}</h4></div>
<div class="admin-item-actions"><button class="admin-edit-btn" onclick="toggleEdit('${a.id}')">${t('edit_btn')}</button><button class="admin-delete-btn" onclick="confirmDel('${a.id}')">${t('delete_btn')}</button></div>
</div>
<div id="ef-${a.id}" style="display:none;margin-top:16px">
<div class="form-group"><label>${t('name_label')}</label><input id="en-${a.id}" value="${esc(a.name)}"></div>
<div class="form-group"><label>${t('icon_label')}</label>${renderIconSelector(a.icon||'bolt','ei-'+a.id)}</div>
<div class="admin-item-row"><div class="form-group"><label>${t('tag_label')}</label><input id="et-${a.id}" value="${esc(a.tag||'')}"></div><div class="form-group"><label>${t('model_label')}</label><input id="em-${a.id}" value="${esc(a.model||'gpt-5.2')}"></div></div>
<div class="form-group"><label>${t('desc_label')}</label><input id="ed-${a.id}" value="${esc(a.description||'')}"></div>
<div class="form-group"><label>${t('welcome_label')}</label><input id="ew-${a.id}" value="${esc(a.welcome||'')}"></div>
<div class="form-group"><label>${t('prompt_label')}</label><textarea id="ep-${a.id}" rows="6">${esc(a.prompt||'')}</textarea></div>
<div class="form-group"><label>${t('order_label')}</label><input id="eo-${a.id}" type="number" value="${a.order||0}" style="width:100px"></div>
<button class="admin-save-btn" onclick="saveA('${a.id}')">${t('save_btn')}</button>
</div></div>`).join('');
}

function esc(s){if(!s)return '';return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'&#10;')}
window.toggleEdit=function(id){const f=document.getElementById('ef-'+id);f.style.display=f.style.display==='none'?'':'none'};
window.saveA=async function(id){
const d={name:document.getElementById('en-'+id).value,icon:document.getElementById('ei-'+id).value,tag:document.getElementById('et-'+id).value,model:document.getElementById('em-'+id).value,description:document.getElementById('ed-'+id).value,welcome:document.getElementById('ew-'+id).value,prompt:document.getElementById('ep-'+id).value,order:parseInt(document.getElementById('eo-'+id).value)||0};
try{await db.collection('assistants').doc(id).update(d);await loadAssistants();if(currentView==='admin')renderAdminList();showToast(t('saved'))}catch(e){alert(t('error'));console.error(e)}
};
document.getElementById('admin-add-btn').addEventListener('click',async()=>{
try{await db.collection('assistants').add({name:"–ù–æ–≤–∏–π –∞—Å–∏—Å—Ç–µ–Ω—Ç",icon:"bolt",description:"–û–ø–∏—Å",tag:"AI",model:"gpt-5.2",prompt:"–¢–∏ ‚Äî AI-–∞—Å–∏—Å—Ç–µ–Ω—Ç.",welcome:"–ß–∏–º –¥–æ–ø–æ–º–æ–≥—Ç–∏?",order:assistantsData.length});await loadAssistants();renderAdminList();showToast(t('saved'))}catch(e){alert(t('error'))}
});
let delId=null;
window.confirmDel=function(id){delId=id;document.getElementById('delete-modal').classList.add('active')};
document.getElementById('delete-cancel').addEventListener('click',()=>{document.getElementById('delete-modal').classList.remove('active');delId=null});
document.getElementById('delete-confirm').addEventListener('click',async()=>{
if(!delId)return;try{await db.collection('assistants').doc(delId).delete();document.getElementById('delete-modal').classList.remove('active');delId=null;await loadAssistants();renderAdminList()}catch(e){alert(t('error'))}
});
document.getElementById('delete-modal').addEventListener('click',e=>{if(e.target===e.currentTarget){document.getElementById('delete-modal').classList.remove('active');delId=null}});
</script>
</body>
</html>
